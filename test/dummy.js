require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var g=require("./creator_globals");g.pathwayObj=require("./pathway_obj");var callCareSenseURL=require("../../js/modules/callCareSenseURL");function initializeCreator(initParams){g.pathwayObj.init(initParams);g.pathway=g.pathwayObj.pathwayObj}module.exports=initializeCreator},{"../../js/modules/callCareSenseURL":23,"./creator_globals":2,"./pathway_obj":14}],2:[function(require,module,exports){var globalObj={};var staffLineReference={0:"action",1:"alert",2:"email",3:"survey",4:"medication",5:"rehab",6:"form",7:"task"};var staffLineLabels={action:"Actions",alert:"Alerts",email:"Information",survey:"Surveys",medication:"Meds",form:"Forms",rehab:"Rehab",task:"Tasks"};var staffLineInfo={action:{index:0,hidden:0},alert:{index:1,hidden:0},email:{index:2,hidden:0},survey:{index:3,hidden:0},medication:{index:4,hidden:0},rehab:{index:5,hidden:0},form:{index:6,hidden:0},task:{index:7,hidden:0}};initGlobals=function(){globalObj.timelineObj={};globalObj.allowTimelineMods=true;globalObj.activePathways=[];globalObj.slideSpeed=750;globalObj.showingActions=false;globalObj.patientPathway;globalObj.myData;globalObj.curDemoStep;globalObj.pathwayHeader={};globalObj.pathwayObj={};globalObj.verticalO=true;globalObj.showGroupIndicators=false;globalObj.showRoleIndicators=false;globalObj.groupsToColors={};globalObj.rolesToColors={};globalObj.eventLevel=[];globalObj.staffLineReference=staffLineReference;globalObj.staffLineLabels=staffLineLabels;globalObj.staffLineInfo=staffLineInfo};window.globalObj=globalObj;initGlobals();module.exports=globalObj},{}],3:[function(require,module,exports){var g=require("../creator_globals");var callCareSenseURL=require("../../../js/modules/callCareSenseURL");function getAllCategoriesAndPathways(callBack){callCareSenseURL("pathways/app/category/getAllCategoriesAndPathways",{},callBack)}function addCategory(categoryName,callBack){callCareSenseURL("pathways/app/category/addCategory",{CategoryName:categoryName},callBack)}function addPathway(pathwayName,categoryID,callBack){callCareSenseURL("pathways/app/pathway/addPathway",{PathwayName:pathwayName,CategoryID:categoryID},callBack)}function showChangePathways(){getAllCategoriesAndPathways(function(returnedData){returnedData=JSON.parse(returnedData);selectInfo={};if(g.pathway.currentPathwayID){categoryID=_.find(returnedData,function(key){return _.size(_.find(key.pathways,function(key2){return key2.id==g.pathway.currentPathwayID}))>0});selectInfo.categoryID=categoryID.id;selectInfo.currentPathwayID=g.pathway.currentPathwayID}$.post("php/change_pathway.php",{myObject:returnedData,selectInfo:selectInfo},function(data){popoverHTML=data;myApp.popover(popoverHTML,$("#changePathways"),true);$$(".switchPathway").click(function(){g.pathway.currentPathwayID=parseInt($("#pathwaySelect").val());myData={};d3.select("#timelineArea").select(".container").remove();g.pathwayObj.init({patientPathway:false,currentPathwayID:g.pathway.currentPathwayID});myApp.closeModal(".popover")});$$(".cancel").click(function(){myApp.closeModal(".popover")});$$(".popover").on("close",function(){$(".remove-on-close").remove()});$$(".categorySelect").on("change",function(){categorySelectChange()});$("#showAddCategory").click(function(){if($("#showAddCategory").html()=="Show"){$("#showAddCategory").html("Hide")}else{$("#showAddCategory").html("Show")}$("#addCategoryRow").toggle()});$("#showAddPathway").click(function(){if($("#showAddPathway").html()=="Show"){$("#showAddPathway").html("Hide")}else{$("#showAddPathway").html("Show")}$("#addPathwayRow").toggle()});$("#addCategoryLink").click(function(){function afterCatAdd(categoryID){$("#categorySelect").append("<option selected value="+categoryID+">"+$("#addCategoryName").val()+"</option>");$("#showAddCategory").trigger("click");$("#addCategoryName").val("");categorySelectChange()}catName=$("#addCategoryName").val();if(catName==""){alert("Please enter a category name.")}else{addCategory(catName,afterCatAdd)}});$("#addPathwayLink").click(function(){function afterPathwayAdd(newPathwayID){$("#pathwaySelect").append("<option selected value="+newPathwayID+">"+$("#addPathwayName").val()+"</option>");$("#showAddPathway").trigger("click");$("#addPathwayName").val("")}pathwayName=$("#addPathwayName").val();catID=$("#categorySelect").val();if(pathwayName==""){alert("Please enter a pathway name.")}else{addPathway(pathwayName,catID,afterPathwayAdd)}});function categorySelectChange(){if($("#categorySelect").val()){myPathways=_.filter(returnedData,function(obj){return obj.id==$("#categorySelect").val()})}else{myPathways=returnedData}$("#pathwaySelect").html("");if(myPathways.length>0){$.each(myPathways[0].pathways,function(key,value){if(g.pathway.currentPathwayID==value.id){$("#pathwaySelect").append("<option selected value="+value.id+">"+value.name+"</option>")}else{$("#pathwaySelect").append("<option value="+value.id+">"+value.name+"</option>")}})}}categorySelectChange()})})}module.exports=showChangePathways},{"../../../js/modules/callCareSenseURL":23,"../creator_globals":2}],4:[function(require,module,exports){var layOut=require("../timeline/pathwaysLayout");var g=require("../creator_globals");var callCareSenseURL=require("../../../js/modules/callCareSenseURL");g.demoSet=false;function init(){$.get("/_pathways/creator/php/demo_area.php",{},function(returnedData){$("#demoArea").html(returnedData)})}function keyDownTextField(e){executeStep();e.stopPropagation}function showDemo(){if($("#toggleDemo").html()=="Show Demo"){g.curDemoStep=0;if(!g.demoSet){g.demoSet=true;document.addEventListener("keydown",keyDownTextField,false)}$("#toggleDemo").html("Hide Demo")}else{$("#timelineArea").width("99%");layOut.resize();$("#demoArea").hide();$("#toggleDemo").html("Show Demo");$("#demo_next_button").css("display","none")}}function executeStep(){g.curDemoStep=g.curDemoStep+1;if(g.curDemoStep==2){}var showTexts=true;switch(g.curDemoStep){case 1:clearAll();centerProcedure();break;case 2:showAlerts();break;case 3:showInitialAlerts();break;case 4:$($(".popover")[0]).addClass("fadedElement");$($(".titleDiv")[0]).removeClass("activeTitleDiv");$($(".titleDiv")[0]).addClass("fadedTitleDiv");$($(".popover")[1]).removeClass("fadedElement");$($(".titleDiv")[1]).addClass("activeTitleDiv");break;case 5:$($(".popover")[1]).addClass("fadedElement");$($(".titleDiv")[1]).removeClass("activeTitleDiv");$($(".titleDiv")[1]).addClass("fadedTitleDiv");$($(".popover")[2]).removeClass("fadedElement");$($(".titleDiv")[2]).addClass("activeTitleDiv");break;case 6:$($(".popover")[2]).addClass("fadedElement");$($(".titleDiv")[2]).removeClass("activeTitleDiv");$($(".titleDiv")[2]).addClass("fadedTitleDiv");$($(".popover")[3]).removeClass("fadedElement");$($(".titleDiv")[3]).addClass("activeTitleDiv");break;case 7:myApp.closeModal(".popover");returnDemoAlerts();break;case 8:hideAlerts();showEmails();break;case 9:highlightDemoEmails();break;case 10:$($(".popover")[0]).addClass("fadedElement");$($(".titleDiv")[0]).removeClass("activeTitleDiv");$($(".titleDiv")[0]).addClass("fadedTitleDiv");$($(".popover")[1]).removeClass("fadedElement");$($(".titleDiv")[1]).addClass("activeTitleDiv");$($("#videoLink")).addClass("fadedElement");$($("#ratingsLink")).removeClass("fadedElement");break;case 11:myApp.closeModal(".popover");returnDemoEmails();break;case 12:hideEmails();showSurveys();g.timelineObj.revealEvents(4,"group",true);break;case 13:highlightDemoSurveys();break;case 14:$($(".popover")[0]).addClass("fadedElement");$($(".titleDiv")[0]).removeClass("activeTitleDiv");$($(".titleDiv")[0]).addClass("fadedTitleDiv");$($(".popover")[1]).removeClass("fadedElement");$($(".titleDiv")[1]).addClass("activeTitleDiv");$($("#iPadImg")).addClass("fadedElement");$($("#audioControls")).removeClass("fadedElement");break;case 15:$($(".popover")[1]).addClass("fadedElement");$($(".titleDiv")[1]).removeClass("activeTitleDiv");$($(".titleDiv")[1]).addClass("fadedTitleDiv");$($(".popover")[2]).removeClass("fadedElement");$($(".titleDiv")[2]).addClass("activeTitleDiv");$($("#audioControls")).addClass("fadedElement");$($("#emailLink")).removeClass("fadedElement");break;case 16:$($(".popover")[2]).addClass("fadedElement");$($(".titleDiv")[2]).removeClass("activeTitleDiv");$($(".titleDiv")[2]).addClass("fadedTitleDiv");$($(".popover")[3]).removeClass("fadedElement");$($(".titleDiv")[3]).addClass("activeTitleDiv");$($("#patientAppImg")).removeClass("fadedElement");$($("#emailLink")).addClass("fadedElement");break;case 17:myApp.closeModal(".popover");returnDemoSurveys();break;case 18:revealAll();$("#toggleDemo").html("Show Demo");g.demoSet=false;document.removeEventListener("keydown",keyDownTextField);break}}function executeBackStep(){switch(g.curDemoStep){case 1:break;case 2:g.curDemoStep=1;break;case 3:g.curDemoStep=1;break;case 4:g.curDemoStep=2;break;case 5:g.curDemoStep=3;break;case 6:g.curDemoStep=3;break;case 7:g.curDemoStep=6;break;case 8:g.curDemoStep=6;break;case 9:g.curDemoStep=8;break;case 10:g.curDemoStep=8;break;case 11:g.curDemoStep=10;break;case 12:g.curDemoStep=10;break;case 13:hightlightEvent(128);break;case 14:hideAlerts();showEmails();g.timelineObj.revealEvents(2,true);break;case 15:g.timelineObj.revealEvents(104,"id",true);break;case 16:hightlightEvent(104);break;case 17:break;case 18:g.timelineObj.revealEvents(2,"group",true);break;case 19:g.timelineObj.revealEvents(576,"id",true);break;case 20:hightlightEvent(576);break;case 21:g.timelineObj.revealEvents(577,"id",true);break;case 22:hightlightEvent(577);break;case 23:hideEmails();showSurveys();g.timelineObj.revealEvents(4,true);break;case 25:g.timelineObj.revealEvents(91,"id",true);break;case 26:g.timelineObj.revealEvents(131,"id",true);break;case 27:g.timelineObj.revealEvents(129,"id",true);break;case 28:break;case 29:g.timelineObj.revealEvents(132,"id",true);break;case 30:break;case 31:g.timelineObj.revealEvents(130,"id",true);break}executeStep();showPowerPoint()}function showPowerPoint(){console.log(g.myData);switch(g.curDemoStep){case 0:title="";content="";break;case 1:title="Overall Timeline";content="The date of surgery is represented by the vertical line";break;case 2:title="Alerts";content="Alerts are text messages or phone calls";break;case 3:title="Alerts";content="Each alert is sent on the date indicated";break;case 4:title="Alerts";content="The content can be customized per message, as can be seen below";break;case 5:title="Alerts";content="An example of this alert can be seen below";break;case 6:title="Alert Use Examples";content="<ul><li><b>Appointment/Class Reminders</b></li></ul>";break;case 8:title="Alert Use Examples";content="<ul><li>Appointment/Class Reminders</li><li><b>Prompts for action</b></li></ul>";break;case 10:title="Alert Use Examples";content="<ul><li>Appointment reminders</li><li>Prompts for action</li><li><b>Instructions</b></li></ul>";break;case 12:title="Alert Use Examples";content="<ul><li>Appointment reminders</li><li>Prompts for action</li><li>Instructions</li><li><b>Information</b></li></ul>";break;case 14:title="Emails";content="CareSense can also send emails to patients";break;case 15:title="Emails";content="Emails serve as a passive means of communication";break;case 16:title="Emails";content="Each email's subject line and body can be customized";break;case 17:title="Emails";content="Extremely customizable";break;case 18:title="Email Uses";content="<ul><li><b>Educate patients over time</b></li></ul>";break;case 19:title="Email Uses";content="<ul><li>Educate patients over time</li><li><b>Send out mailings</b></li></ul>";break;case 21:title="Email Uses";content="<ul><li>Educate patients over time</li><li>Send out mailings</li><li><b>Improve online reputation</b></li></ul>";break;case 23:title="Surveys";content="CareSense can also survey patients";break;case 24:title="Surveys";content="There are 5 different ways to survey patients in the system</li></ul>";break;case 25:title="Surveys";content="<ul><li><b>In office surveys (iPads)</b></li></ul>";break;case 26:title="Surveys";content="<ul><li>In office surveys (iPads)</li><li><b>Email Surveys</b></li></ul>";break;case 27:title="Surveys";content="<ul><li>In office surveys (iPads)</li><li>Email Surveys</li><li><b>Text Link (App alert)</b></li></ul>";break;case 29:title="Surveys";content="<ul><li>In office surveys (iPads)</li><li>Email Surveys</li><li>Text Link</li><li><b>Text Prompted</b></li></ul>";break;case 31:title="Surveys";content="<ul><li>In office surveys (iPads)</li><li>Email Surveys</li><li>Text Link</li><li>Text Prompted</li><li><b>Phone</b></li></ul>";break;case 32:title="CareSense Pathways";content="That's just the beginning of pathways:<br><ul><li>Pathways in all specialties</li><li>Medication reminders</li><li>Branching</li><li>Physician alerts</li><li>Analytics</li><li>Patient App</li><li>...and more</li></ul>";break}powerPoint(title,content)}function powerPoint(title,content){$("#powerpoint_title").html(title);$("#powerpoint_content").html(content)}function clearAll(){g.staffLineInfo["alert"].hidden=1;g.staffLineInfo["email"].hidden=1;g.staffLineInfo["survey"].hidden=1;g.staffLineInfo["medication"].hidden=1;$(".alert").hide();$(".email").hide();$(".survey").hide();$(".emailText").hide();$(".surveyText").hide();$(".alertText").hide();$(".medication").hide();$(".medicationText").hide();g.timelineObj.callRefreshEvents()}function revealAll(){g.timelineObj.revealEvents(4,"group",true);d3.transition().duration(700).tween("zoom",function(){var ix=d3.interpolateRound(-350,50);return function(t){newScaleVals=ix(t);g.timelineObj.callShiftAxis(newScaleVals,5,false)}}).each("end",function(d){g.staffLineInfo["alert"].hidden=0;g.staffLineInfo["email"].hidden=0;g.staffLineInfo["survey"].hidden=0;$(".alert").show();$(".email").show();$(".survey").show();$(".emailText").show();$(".surveyText").show();$(".alertText").show();g.timelineObj.callRefreshEvents();g.timelineObj.callSetScaleDynamically(d3.extent(g.myData.map(function(d){return moment.utc(d.start_date)._d})))})}function centerProcedure(){smallDate=new Date(moment());smallDateConv=smallDate.setDate(smallDate.getDate()-3);bigDate=new Date(moment());bigDateConv=bigDate.setDate(bigDate.getDate()+3);g.timelineObj.callSetScaleDynamically([smallDateConv,bigDateConv])}function showAlerts(){g.timelineObj.revealEvents(1,"group",true);$(".alert").show();$(".alertText").show();g.staffLineInfo["alert"].hidden=0;g.timelineObj.callRefreshEvents()}function showEmail(num){$("#emailContainer").show();if(num==1){$("#emailContainer").html('<div id="subject"><b>Subj:</b>&nbsp;Intoductory Email</div><br><div id="body">Hello Charlie,<BR><BR>In order to achieve the best results from surgery and ensure everything goes smoothly, the longer you have to prepare, the better. Your surgeon may ask you to have a comprehensive medical evaluation to clear yourself for the operation and to take some diagnostic tests. These will help your orthopedist decide what type of knee replacement is best for you. You should also begin a pre-surgical exercise routine to help prepare your body for the procedure. After all, a stronger leg going into surgery is also a stronger leg out of surgery and can make your recovery faster and easier. In addition, you can watch this video to get a sense for what you need to do:<br><br><a href=\'http://prod.neverst.depuy.edgesuite.net/kneepilot/presurgery.mp4\'>http://prod.neverst.depuy.edgesuite.net/kneepilot/presurgery.mp4</a><br><br>Best regards,<br><br>Dr. Smith</div>')}else if(num==2){$("#emailContainer").html('<div id="subject"><b>Subj:</b>&nbsp;Upcoming talk</div><br><div id="body">Hello Charlie,<BR><BR>On Thursday, October 26th, I will be speaking at the Radisson Hotel ballroom. If you are interested in learning more about your upcoming procedure, you are invited to attend. The event starts at 5 PM and will be free. Best regards,<br><br>Dr. Smith</div>')}else if(num==3){$("#emailContainer").html('<div id="subject"><b>Subj:</b>&nbsp;Online rating</div><br><div id="body">Hello Charlie,<BR><BR>We would love for you to visit <a>www.healthgrades.com/john-smith</a> to leave a rating. This will help other patients understand what to expect when looking online. Best regards,<br><br>Dr. Smith</div>')}else if(num==4){$("#emailContainer").html('<div id="subject"><b>Subj:</b>&nbsp;Follow-up from Dr. Smith</div><br><div id="body">Hello Charlie,<BR><BR>It\'s been 4 weeks since your right knee procedure with Dr. Marchand and we would like to know how you are doing. It is very important to us that you click on the link below and answer the questions to the best of your ability:<br><br><a href=\'https://www.caresense.com/survey/kiosk/mountainviewemail\'>https://www.caresense.com/email/3849235</a><br><br>Best regards,<br><br>Dr. Smith</div>')}}function hideAlerts(){$(".alert").hide();$(".alertText").hide();g.staffLineInfo["alert"].hidden=1;g.timelineObj.callRefreshEvents()}function showEmails(){$(".email").show();$(".emailText").show();g.staffLineInfo["email"].hidden=0;g.timelineObj.callShiftAxis(100,5,false);g.timelineObj.callRefreshEvents()}function hideEmails(){$(".email").hide();$(".emailText").hide();g.staffLineInfo["email"].hidden=1;g.timelineObj.callRefreshEvents()}function showSurveys(){$(".survey").show();$(".surveyText").show();g.staffLineInfo["survey"].hidden=0;g.timelineObj.callShiftAxis(-350,5,false);g.timelineObj.callRefreshEvents()}function sendTextmessage(){eventIndicatorToHighlight=d3.select("#event126");eventIndicatorToHighlight.each(function(d){eventIndicators.hightlightEvent(d,d3.select(this))})}function revealAndShow(group,alert){g.timelineObj.revealEvents(group,true);setTimeout(function(){hightlightAlert(alert)},750)}function revealGroup(group){g.timelineObj.revealEvents(group,true);setTimeout(function(){hightlightAlert(alert)},750)}function showInitialAlert(){d3.transition().duration(700).tween("zoom",function(){var ix=d3.interpolateRound(50,230);return function(t){newScaleVals=ix(t);g.timelineObj.callShiftAxis(newScaleVals,5,false)}}).each("end",function(d){g.timelineObj.revealEvents(126,"id",true)})}function hightlightEvent(eventID){eventIndicatorToHighlight=d3.select("#event"+eventID)}function showTextMessages(){$("#textContainer").show();$("<iframe/>",{name:"demoContentFrame",id:"demoContentFrame",src:"http://www.textnow.com/messaging"}).appendTo("#demoContent")}function hideTextMessages(){$("#textContainer").hide();$("#demoContentFrame").remove()}function showInitialAlerts(){d3.transition().duration(700).tween("zoom",function(){var ix=d3.interpolateRound(50,230);return function(t){newScaleVals=ix(t);g.timelineObj.callShiftAxis(newScaleVals,5,false)}}).each("end",function(d){highlightDemoAlerts()})}function highlightDemoAlerts(){d3.selectAll("#event124").attr("class","eventIndicator showMe");d3.selectAll("#event123").attr("class","eventIndicator showMe");d3.selectAll("#event127").attr("class","eventIndicator showMe");d3.selectAll("#event574").attr("class","eventIndicator showMe");d3.selectAll(".showMe").transition().duration(700).attr("transform",function(d){var translate;translate=d.x+", 0";return"translate("+translate+")"});d3.select(".indicators").selectAll("circle").style("visibility","hidden");d3.select(".vertLines").style("visibility","hidden");$(".eventIndicator:not(.showMe)").hide();showAlertBenefits()}function returnDemoAlerts(){d3.selectAll(".showMe").transition().duration(700).attr("transform",function(d){var translate;translate=d.x+", "+d.y;return"translate("+translate+")"});setTimeout(function(){d3.select(".indicators").selectAll("circle").style("visibility","visible");d3.select(".vertLines").style("visibility","visible");$(".eventIndicator:not(.showMe)").show()},710)}function showAlertBenefits(){var appointmentHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv activeTitleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 5px;"><b>Reduce Missed Appointments</b></p>'+'<p style="font-size:16px; ">"You have an appointment tomorrow at 3 o\'clock. Please show up 15 minutes early."</p>'+"</div>"+"</div>"+"</div>";var surgeryHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 5px;"><b>Lower Surgerical Cancellations</b></p>'+'<p style="font-size:16px; ">"Remember to fill our your online forms. You cannot have surgery without them"</p>'+"</div>"+"</div>"+"</div>";var complianceHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 5px;"><b>Increase Compliance</b></p>'+'<p style="font-size:16px; ">"STOP taking Aspirin at this point"</p>'+"</div>"+"</div>"+"</div>";var serviceHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3;  border-width: 1px; padding: 5px;"><b>Improve Service</b></p>'+'<p style="font-size:16px; ">"You can always call 555-643-4364 if you have any questions or problems"</p>'+"</div>"+"</div>"+"</div>";setTimeout(function(){myApp.popover(appointmentHTML,$("#event124").find("text"));myApp.popover(surgeryHTML,$("#event574").find("text"));myApp.popover(complianceHTML,$("#event123").find("text"));myApp.popover(serviceHTML,$("#event127").find("text"));$($(".popover")[1]).addClass("fadedElement");$($(".popover")[2]).addClass("fadedElement");$($(".popover")[3]).addClass("fadedElement");$($(".titleDiv")[1]).addClass("fadedTitleDiv");$($(".titleDiv")[2]).addClass("fadedTitleDiv");$($(".titleDiv")[3]).addClass("fadedTitleDiv")},710)}function highlightDemoEmails(){d3.selectAll("#event104").attr("class","eventIndicator showMeEmail");d3.selectAll("#event577").attr("class","eventIndicator showMeEmail");d3.selectAll("circle").style("visibility","hidden");d3.select(".vertLines").style("visibility","hidden");$(".eventIndicator:not(.showMeEmail)").hide();setTimeout(function(){showEmailBenefits();d3.selectAll(".showMeEmail").transition().duration(700).attr("transform",function(d){var translate;translate=d.x+", 0";return"translate("+translate+")"})},250)}function showEmailBenefits(){var appointmentHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv activeTitleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 5px;"><b>Better Education</b></p>'+'<p style="border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 10px; font-size:14px; width:400px ">Jack,<br><br>Thank you for choosing Mountain View Orthopedics for your surgery! Please refer to page 14 of your packet for some initial information and watch the video below for a custom message from your doctor:<br><br><a id="videoLink">Click to watch video</a><br><br>-Dr. Smith</p>'+"</div>"+"</div>"+"</div>";var surgeryHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 5px;"><b>Manage Online Reputation</b></p>'+'<p style="border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 10px; font-size:14px; width:400px ">Jack,<br><br>We would love for you to visit <a class="fadedElement" id="ratingsLink">www.healthgrades.com/mark-smith</a> to leave a rating. This will help other patients understand what to expect when looking online. Best regards,<br><br>-Dr. Smith</p>'+"</div>"+"</div>"+"</div>";setTimeout(function(){myApp.popover(appointmentHTML,$("#event104").find("text"));myApp.popover(surgeryHTML,$("#event577").find("text"));$($(".popover")[0]).addClass("emailPopover");$($(".popover")[1]).addClass("emailPopover");$($(".popover")[1]).addClass("fadedElement");$($(".titleDiv")[1]).addClass("fadedTitleDiv")},710)}function returnDemoEmails(){d3.selectAll(".showMeEmail").transition().duration(700).attr("transform",function(d){var translate;translate=d.x+", "+d.y;return"translate("+translate+")"});setTimeout(function(){d3.selectAll("circle").style("visibility","visible");d3.select(".vertLines").style("visibility","visible");$(".eventIndicator:not(.showMe)").show()},710)}function highlightDemoSurveys(){d3.selectAll("#event91").attr("class","eventIndicator showMeSurvey");d3.selectAll("#event132").attr("class","eventIndicator showMeSurvey");d3.selectAll("#event131").attr("class","eventIndicator showMeSurvey");d3.selectAll("#event129").attr("class","eventIndicator showMeSurvey");d3.selectAll("circle").style("visibility","hidden");d3.select(".vertLines").style("visibility","hidden");$(".eventIndicator:not(.showMeSurvey)").hide();setTimeout(function(){showSurveyBenefits();d3.selectAll(".showMeSurvey").transition().duration(700).attr("transform",function(d){var translate;translate=d.x+", 0";return"translate("+translate+")"})},250)}function showSurveyBenefits(){var appointmentHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv activeTitleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 5px;"><b>Collect Outcomes Surveys</b></p>'+'<img id="iPadImg" src="imgs/iPad.png" width="300px">'+"</div>"+"</div>"+"</div>";var surgeryHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 5px;"><b>Reduce Readmissions</b></p>'+'<p style="font-size:16px; ">"Is your knee still swollen?"</p>'+'<p id="audioControls" class="fadedElement" style="font-size:16px; "><audio controls><source src="recordings/pain_question.wav" type="audio/wav"></audio></p>'+"</div>"+"</div>"+"</div>";var complianceHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 5px;"><b>Increase Compliance with Emails</b></p>'+'<p style="font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3; border-width: 1px; padding: 10px;">"Jack<br><br>Please fill out a survey by clicking the link below:<br><br><a id="emailLink" class="fadedElement">www.caresense.com/emailSurvey</a><br><br>- Dr. Smith"</p>'+"</div>"+"</div>"+"</div>";var serviceHTML='<div class="popover">'+'<div class="popover-inner">'+'<div class="content-block">'+'<p class="titleDiv" style="text-align:center; font-size:16px; border-radius: 5px;  border-style: solid; border-color: #a6c1d3;  border-width: 1px; padding: 5px;"><b>Patient App</b></p>'+'<img id="patientAppImg" class="fadedElement" src="imgs/PatientApp.png" width="300px">'+"</div>"+"</div>"+"</div>";setTimeout(function(){myApp.popover(appointmentHTML,$("#event91").find("text"));myApp.popover(surgeryHTML,$("#event132").find("text"));myApp.popover(complianceHTML,$("#event131").find("text"));myApp.popover(serviceHTML,$("#event129").find("text"));$($(".popover")[1]).addClass("fadedElement");$($(".popover")[2]).addClass("fadedElement");$($(".popover")[3]).addClass("fadedElement");$($(".titleDiv")[1]).addClass("fadedTitleDiv");$($(".titleDiv")[2]).addClass("fadedTitleDiv");$($(".titleDiv")[3]).addClass("fadedTitleDiv")},710)}function returnDemoSurveys(){d3.selectAll(".showMeSurvey").transition().duration(700).attr("transform",function(d){var translate;translate=d.x+", "+d.y;return"translate("+translate+")"});setTimeout(function(){d3.selectAll("circle").style("visibility","visible");d3.select(".vertLines").style("visibility","visible");$(".eventIndicator:not(.showMeSurvey)").show()},710)}var demoObj={init:init,showDemo:showDemo,executeStep:executeStep};module.exports=demoObj},{"../../../js/modules/callCareSenseURL":23,"../creator_globals":2,"../timeline/pathwaysLayout":20}],5:[function(require,module,exports){var layOut=require("../timeline/pathwaysLayout");var g=require("../creator_globals");var callCareSenseURL=require("../../../js/modules/callCareSenseURL");var timelineObj=require("../timeline/timeline");function getGroupEvents(pathwayID,groupID,callBack){}function createPathwayGroup(pathwayID,groupName,groupDescription,showOnDefault,callBack){callCareSenseURL("pathways/app/group/createPathwayGroup",{PathwayID:pathwayID,GroupName:groupName,GroupDescription:groupDescription,ShowOnDefault:showOnDefault},callBack)}function updatePathwayGroup(groupID,groupName,groupDescription,showOnDefault,callBack){callCareSenseURL("pathways/app/group/updatePathwayGroup",{GroupID:groupID,GroupName:groupName,GroupDescription:groupDescription,ShowOnDefault:showOnDefault},callBack)}function addGroupToPathway(pathwayID,groupID,callBack,callBackParams){callCareSenseURL("pathways/app/group/copyGroupIntoPathway",{PathwayID:pathwayID,GroupID:groupID},callBack,callBackParams)}function returnAllMatchingGroups(keyword,callBack){callCareSenseURL("pathways/app/group/returnAllMatchingGroups",{Keyword:keyword},callBack)}function deletePathwayGroup(pathwayID,groupID,callBack){callCareSenseURL("pathways/app/group/deletePathwayGroup",{PathwayID:pathwayID,GroupID:groupID},callBack)}function toggleActiveForAssignedPathwayGroup(currentAssignedPathwayID,groupID,show,callBack){callCareSenseURL("pathways/app/pathway/toggleActiveForAssignedPathwayGroup",{AssignedPathwayID:currentAssignedPathwayID,Active:show,Group:groupID},callBack)}function toggleEvents(groupID,show){if(show){g.activePathways.push(parseInt(groupID));$("#HighlightLink"+groupID).show()}else{g.activePathways=_.filter(g.activePathways,function(id){return id!=groupID});$("#HighlightLink"+groupID).hide()}if(g.pathway.patientPathway){var active;if(show){active=1}else{active=0}toggleActiveForAssignedPathwayGroup(g.pathway.assignedPathwayID,groupID,active,function(data){})}timelineObj.callRefreshEvents()}function refreshInterface(){g.pathwayObj.getPathwayGroups(g.pathway.currentPathwayID,false,function(){g.pathwayHeader.initializeHeader()})}function createGroup(){if($("#GroupName").val()!=""){if($("#ShowOnDefault").is(":checked")){showOnDefault=1}else{showOnDefault=0}createPathwayGroup(g.pathway.currentPathwayID,$("#GroupName").val(),$("#GroupDescription").val(),showOnDefault,refreshInterface)}}function deleteGroup(groupID){g.pathway.myData=_.filter(g.pathway.myData,function(event){return!_.contains(event.groups,groupID)});deletePathwayGroup(g.pathway.currentPathwayID,groupID,refreshAll)}function editGroup(that,groupID,name,description,show_on_default){var d={};d.description=description;d.name=name;d.show_on_default=show_on_default;$.post("php/group_details_edit.php",{myObject:d},function(data){popoverHTML=data;myApp.popover(popoverHTML,$(that),true);$$(".saveChanges").click(function(){var storedData=myApp.formToJSON("#my-form");if(storedData.show_on_default=="on"){showOnDefault=1}else{showOnDefault=0}saveGroupChanges(groupID,storedData.group_name,storedData.group_description,showOnDefault);
myApp.closeModal(".popover")});$$(".cancel").click(function(){myApp.closeModal(".popover")});$$(".popover").on("close",function(){$(".remove-on-close").remove()})})}function saveGroupChanges(groupID,name,description,showOnDefault){updatePathwayGroup(groupID,name,description,showOnDefault,function(){toggleEvents(groupID,showOnDefault==1);refreshAll()})}function toggleGroupOptions(){if($("#toggleGroupOptions").html()=="Show Group Options"){$("#timelineArea").width("75%");layOut.resize();$("#currPathwayArea").show();$("#toggleGroupOptions").html("Hide Group Options")}else{$("#timelineArea").width("99%");layOut.resize();hideGroupOptions()}}function hideGroupOptions(){$("#currPathwayArea").hide();$("#toggleGroupOptions").html("Show Group Options");hideActiveGroup()}function searchForGroups(){searchTerm=$("#groupSearch").val();if(searchTerm!=""){returnAllMatchingGroups(searchTerm,showResults)}else{$("#searchResults").html('<div style="margin:5px">Please enter a search term</div>')}}function showResults(data){var myData=JSON.parse(data);if(myData.group_ids.length>0){$("#searchResults").html("");$("#searchResults").append('<ul style="margin:5px">');$.each(myData.group_ids,function(key,value){myData.group_descriptions.hasOwnProperty(key)?description=myData.group_descriptions[key]:description="";myData.group_names.hasOwnProperty(key)?name=myData.group_names[key]:name="";myData.pathway_names.hasOwnProperty(key)?pathwayName=myData.pathway_names[key]:pathwayName="";var html="<li >";html=html+'<div><a style="cursor:pointer"  class="groupDetails" data-value="'+value+'" data-name="'+name+'"  data-description="'+description+'" data-pathwayname="'+pathwayName+'">'+name+"</a></div>";html=html+"</li>";$("#searchResults").children("ul").append(html)});$(".groupDetails").on("click",function(){showAddGroupDetails(this,$(this).data("description"),$(this).data("name"),$(this).data("pathwayname"),$(this).data("value"))})}else{$("#searchResults").html('<div style="margin:5px">No results found</div>')}}function showAddGroupDetails(that,description,name,pathwayName,groupID){var d={};d.description=description;d.name=name;d.pathwayName=pathwayName;$.post("php/group_details.php",{myObject:d},function(data){popoverHTML=data;myApp.popover(popoverHTML,$(that),true);$$(".addGroup").click(function(){addGroupToPathway(g.pathway.currentPathwayID,groupID,addGroupEvents);myApp.closeModal(".popover")});$$(".cancel").click(function(){myApp.closeModal(".popover")})})}function addGroupEvents(newGroupID){g.activePathways.push(newGroupID);getGroupEvents(g.pathway.currentPathwayID,newGroupID,addGroupToTimeline)}function addGroupToTimeline(data){data=JSON.parse(data);$.each(data.events,function(key,value){value.start_date=moment(value.start_date).utc()._d;if(_.has(value,"extended_details")){value.extended_details.end_date=moment(value.extended_details.end_date)._d}g.pathway.myData.push(value)});refreshAll()}function showActiveGroup(){if($(".groupEditor").is(":checked")){globalObj.showGroupIndicators=true;$("#groupSelectDiv").show();timelineObj.showGroupIndicators();timelineObj.callRefreshEvents()}else{hideActiveGroup()}}function hideActiveGroup(){globalObj.showGroupIndicators=false;$(".groupEditor").attr("checked",false);$("#groupSelectDiv").hide();timelineObj.hideGroupIndicators();timelineObj.callRefreshEvents()}function refreshAll(){refreshInterface();timelineObj.callRefreshEvents()}var groupObj={toggleEvents:toggleEvents,createGroup:createGroup,deleteGroup:deleteGroup,editGroup:editGroup,toggleGroupOptions:toggleGroupOptions,searchForGroups:searchForGroups,showActiveGroup:showActiveGroup,hideGroupOptions:hideGroupOptions};module.exports=groupObj},{"../../../js/modules/callCareSenseURL":23,"../creator_globals":2,"../timeline/pathwaysLayout":20,"../timeline/timeline":21}],6:[function(require,module,exports){var groupObj=require("../group_interface");var timelineObj=require("../../timeline/timeline");function initHorizontalGroup(){updateHandlers()}function updateHandlers(){$(".groupCheckBox").on("click",function(){groupObj.toggleEvents($(this).data("groupids"),$(this).is(":checked"))});$(".groupEditor").on("click",function(){groupObj.showActiveGroup(timelineObj)});$(".Highlightlink").on("click",function(){showHighlight=$(this).html()=="Highlight";timelineObj.revealEvents($(this).data("groupids"),"group",showHighlight);showHighlight?$(this).html("Return"):$(this).html("Highlight")});$(".editGroup").on("click",function(){groupObj.editGroup(this,$(this).data("groupids"),$(this).data("groupnames"),$(this).data("groupdescriptions"),$(this).data("defaultactive"))});$(".deleteGroup").on("click",function(){groupObj.deleteGroup($(this).data("groupids"))});$(".createGroup").on("click",function(){groupObj.createGroup()});$(".groupSearch").on("click",function(){groupObj.searchForGroups()})}var currPathwaysObj={initHorizontalGroup:initHorizontalGroup};module.exports=currPathwaysObj},{"../../timeline/timeline":21,"../group_interface":5}],7:[function(require,module,exports){var groupObj=require("../group_interface");var roleObj=require("../role_interface");var pathwayObj=require("../pathway_interface");var recordingObj=require("../recording_interface");var demoObj=require("../demo");var changePathwaysObj=require("../change_pathways");function initHorizontalGroup(){demoObj.init();updateHandlers()}function updateHandlers(){$("#toggleGroupOptions").on("click",function(){groupObj.toggleGroupOptions();roleObj.hideRoleOptions()});$("#toggleRoleOptions").on("click",function(){roleObj.toggleRoleOptions();groupObj.hideGroupOptions()});$("#togglePathwayOptions").on("click",function(){pathwayObj.showPathwayOptions()});$("#recordingLink").on("click",function(){recordingObj.recordAlerts()});$("#toggleDemo").on("click",function(){demoObj.showDemo()});$("#demoNext").on("click",function(){demoObj.executeStep()});$("#changePathways").on("click",function(){changePathwaysObj()})}var currPathwaysObj=initHorizontalGroup;module.exports=currPathwaysObj},{"../change_pathways":3,"../demo":4,"../group_interface":5,"../pathway_interface":10,"../recording_interface":11,"../role_interface":12}],8:[function(require,module,exports){function initRecordings(getTwilioFile,savePath){updateHandlers(getTwilioFile,savePath)}function updateHandlers(getTwilioFile,savePath){$$(".getRecording").click(function(){eventID=$(this).data("eventid");name=$(this).data("recordingname");function saveInfo(){savePath(eventID,name)}getTwilioFile(this,name,saveInfo)})}module.exports=initRecordings},{}],9:[function(require,module,exports){var roleObj=require("../role_interface");var timelineObj=require("../../timeline/timeline");function initHorizontalRole(){updateHandlers()}function updateHandlers(){$(".roleEditor").on("click",function(){roleObj.showActiveRole(timelineObj);timelineObj.callRefreshEvents()});$(".highlightRoleLink").on("click",function(){showHighlight=$(this).html()=="Highlight";timelineObj.revealEvents($(this).data("roleids"),"role",showHighlight);showHighlight?$(this).html("Return"):$(this).html("Highlight")});$(".deleteRoleLink").on("click",function(){roleObj.deleteRole($(this).data("roletopathwayids"))});$(".addRole").on("click",function(){roleObj.addRole()})}var currPathwaysObj={initHorizontalRole:initHorizontalRole};module.exports=currPathwaysObj},{"../../timeline/timeline":21,"../role_interface":12}],10:[function(require,module,exports){var g=require("../creator_globals");var callCareSenseURL=require("../../../js/modules/callCareSenseURL");function getAllPathwayData(pathwayID,callBack){callCareSenseURL("pathways/app/pathway/returnPathwayInfo",{PathwayID:pathwayID},callBack)}function updatePathwayData(pathwayID,pathwayData,callBack){callCareSenseURL("pathways/app/pathway/updatePathwayInfo",{PathwayData:pathwayData,PathwayID:pathwayID},callBack)}function showPathwayOptions(){getAllPathwayData(g.pathway.currentPathwayID,function(returnedData){returnedData=JSON.parse(returnedData);selectInfo={};$.post("php/pathway_options.php",{myObject:returnedData},function(data){popoverHTML=data;myApp.popover(popoverHTML,$("#togglePathwayOptions"),true);$$(".cancel").click(function(){myApp.closeModal(".popover")});$$(".popover").on("close",function(){$(".remove-on-close").remove()});$$(".savePathwayOptions").click(function(){var queryString=$("#PathwayOptionsForm").serialize();var fail=false;if($("#name").val()==""){myApp.alert("Please enter a pathway name");fail=true}if(!fail){updatePathwayData(g.pathway.currentPathwayID,queryString,resetPathwayInfo)}function resetPathwayInfo(){myData={};d3.select("#timelineArea").select(".container").remove();g.pathwayObj.init({patientPathway:false,currentPathwayID:g.pathway.currentPathwayID});myApp.closeModal(".popover")}})})})}var pathwaysObj={showPathwayOptions:showPathwayOptions};module.exports=pathwaysObj},{"../../../js/modules/callCareSenseURL":23,"../creator_globals":2}],11:[function(require,module,exports){var g=require("../creator_globals");var callCareSenseURL=require("../../../js/modules/callCareSenseURL");var layOut=require("../timeline/pathwaysLayout");var handler=require("./handlers/recording_handlers");function getAlertRecordings(pathwayID,callBack){callCareSenseURL("pathways/app/timeline/returnAllAlertsForPathway",{PathwayID:pathwayID},callBack)}function updateAlertRecordingPath(alertID,alertPath,callBack){callCareSenseURL("pathways/app/timeline/updateAlertPath",{AlertID:alertID,AlertPath:alertPath},callBack)}function init(){$(function(){$.ajax({url:"//"+location.host+"/pathways/app/record/generateAlertRecordingToken",success:function(data){if(typeof Twilio!="undefined"){Twilio.Device.setup(data)}},error:function(data,status,error){alert("error")}})})}function savePath(alertID,alertPath){alertPath=alertPath+".wav";updateAlertRecordingPath(alertID,alertPath,refreshRecordings)}function recordAlerts(){if($("#recordingLink").html()=="Record"){curDemoStep=0;$("#timelineArea").width("60%");layOut.resize();$("#recordingArea").show();$("#recordingLink").html("Hide Record");refreshRecordings()}else{$("#timelineArea").width("99%");layOut.resize();$("#recordingArea").hide();$("#recordingLink").html("Record")}}function refreshRecordings(){getAlertRecordings(g.pathway.currentPathwayID,showRecordings);function showRecordings(data){data=JSON.parse(data);$.post("php/get_alert_recordings.php",{alerts:data},function(resultingHTML){$("#recordingArea").html(resultingHTML);handler(getTwilioFile,savePath)})}}var getTwilioFile=function(link,name,callback){if($(link).html()=="Record"){var connection=null;var address="//"+location.host+"/login/generateLoginToken/";$.ajax({type:"POST",url:address,success:function(data){APIKey=data;myParams="Name="+name+"&CallBack="+callback;params={ParamString:myParams};connection=Twilio.Device.connect({Name:name,APIKey:APIKey.token});$(link).html("Stop")},error:function(data,status,error){console.log("error")}})}else{updateRecording(link,callback)}};function updateRecording(link,callback){$(link).html("Record");Twilio.Device.disconnectAll();setTimeout(function(){callback()},3e3)}var alertRecordingObj={init:init,savePath:savePath,recordAlerts:recordAlerts};module.exports=alertRecordingObj},{"../../../js/modules/callCareSenseURL":23,"../creator_globals":2,"../timeline/pathwaysLayout":20,"./handlers/recording_handlers":8}],12:[function(require,module,exports){var layOut=require("../timeline/pathwaysLayout");var g=require("../creator_globals");var callCareSenseURL=require("../../../js/modules/callCareSenseURL");var timelineObj=require("../timeline/timeline");function addRoleToPathway(pathwayID,roleID,callBack){callCareSenseURL("pathways/app/role/addPathwayRole",{PathwayID:pathwayID,RoleID:roleID},callBack)}function deletePathwayRole(roleToPathwayID,callBack){callCareSenseURL("pathways/app/role/deletePathwayRole",{RoleToPathwayID:roleToPathwayID},callBack)}function toggleRoleOptions(){if($("#toggleRoleOptions").html()=="Show Role Options"){$("#timelineArea").width("75%");layOut.resize();$("#rolesArea").show();$("#toggleRoleOptions").html("Hide Role Options")}else{$("#timelineArea").width("99%");layOut.resize();hideRoleOptions()}}function hideRoleOptions(){$("#rolesArea").hide();$("#toggleRoleOptions").html("Show Role Options");hideActiveRole()}function showActiveRole(timelineObj){if($(".roleEditor").is(":checked")){globalObj.showRoleIndicators=true;$("#roleSelectDiv").show();timelineObj.showRoleIndicators()}else{hideActiveRole()}}function hideActiveRole(){globalObj.showRoleIndicators=false;$(".roleEditor").attr("checked",false);$("#roleSelectDiv").hide();timelineObj.hideRoleIndicators()}function addRole(){addRoleToPathway(g.pathway.currentPathwayID,$("#addRoleSelect").val(),refreshInterface)}function deleteRole(roleToPathwayID){deletePathwayRole(roleToPathwayID,refreshAll)}function refreshInterface(){g.pathwayObj.getPathwayRoles(g.pathway.currentPathwayID,function(){g.pathwayHeader.initializeHeader()})}function refreshAll(){hideRoleOptions();$("#timelineArea").width("99%");layOut.resize();myData={};d3.select("#timelineArea").select(".container").remove();g.pathwayObj.init({patientPathway:false,currentPathwayID:g.pathway.currentPathwayID});myApp.closeModal(".popover")}var roleObj={toggleRoleOptions:toggleRoleOptions,showActiveRole:showActiveRole,hideRoleOptions:hideRoleOptions,hideActiveRole:hideActiveRole,addRole:addRole,deleteRole:deleteRole};module.exports=roleObj},{"../../../js/modules/callCareSenseURL":23,"../creator_globals":2,"../timeline/pathwaysLayout":20,"../timeline/timeline":21}],13:[function(require,module,exports){var g=require("./creator_globals");var callCareSenseURL=require("../../js/modules/callCareSenseURL");var currPathwaysInit=require("./interface/handlers/curr_pathways");var roleArea=require("./interface/handlers/role_handler");var recordingInit=require("./interface/recording_interface");var horizontalHeaderInit=require("./interface/handlers/horizontal_header");var groupObj=require("./interface/group_interface");var layOut=require("./timeline/pathwaysLayout");function getAllCategoriesAndPathways(callBack){callCareSenseURL("pathways/app/category/getAllCategoriesAndPathways",{},callBack)}function getPathwayName(pathwayID,callBack){callCareSenseURL("pathways/app/pathway/returnPathwayName",{PathwayID:pathwayID},callBack)}function activateAddedEvents(pathwayID,callBack){callCareSenseURL("pathways/app/pathway/activateAddedEvents",{AssignedPathwayID:pathwayID},callBack)}function initializeCurrPathwayMenu(data){$.post("/_pathways/creator/php/curr_pathways.php",{myObject:data},function(returnedData){$("#currPathwayArea").html(returnedData);currPathwaysInit.initHorizontalGroup()})}function initializeRolesMenu(myRoles,allRoles){$.post("/_pathways/creator/php/roles_area.php",{myRoles:myRoles,allRoles:allRoles},function(returnedData){$("#rolesArea").html(returnedData);roleArea.initHorizontalRole()})}function initializeHeader(){pathwayObj=g.pathwayObj.pathwayObj;initializeCurrPathwayMenu(pathwayObj.groups);initializeRolesMenu(pathwayObj.roles,pathwayObj.allRoles);if(!g.verticalO){recordingInit.init()}$("#goBack").on("click",function(){activateAddedEvents(pathwayObj.assignedPathwayID)});if(!g.verticalO){if(!pathwayObj.patientPathway){$.post("/_pathways/creator/php/horizontal_header.php",{myObject:pathwayObj.groups},function(returnedData){$("#pathway_header").html(returnedData);horizontalHeaderInit();getPathwayName(pathwayObj.currentPathwayID,function(name){$("#PathwayTitle").html(name)})})}}else{$("#showGroupOptionsVertical").on("click",function(){$("#pathwayGroups").toggle();layOut.resize()});if(!g.allowTimelineMods){$("#showGroupOptionsVertical").hide()}else{$("#showGroupOptionsVertical").show()}if(!pathwayObj.patientPathway){getAllCategoriesAndPathways(function(catsAndPathways){catsAndPathways=JSON.parse(catsAndPathways);if(pathwayObj.currentPathwayID){getPathwayName(pathwayObj.currentPathwayID,function(name){$("#PathwayTitle").html(name)})}else{$("#PathwayTitle").html("Assign Pathway")}})}else{$.post("/_pathways/creator/php/curr_pathways_vertical.php",{myObject:pathwayObj.groups},function(returnedData){$("#pathway_header").html(returnedData);$(".toggleGroup").on("change",function(){groupObj.toggleEvents($(this).val(),$(this).is(":checked"));g.timelineObj.callRefreshEvents()});$(".Highlightlink").on("click",function(){showHighlight=$(this).html()=="Highlight";g.timelineObj.revealEvents($(this).data("groupids"),"group",showHighlight);showHighlight?$(this).html("Return"):$(this).html("Highlight")});getPathwayName(pathwayObj.currentPathwayID,function(name){$("#PathwayTitle").html(name)})})}}}var headerObj={initializeHeader:initializeHeader,initializeCurrPathwayMenu:initializeCurrPathwayMenu};module.exports=headerObj},{"../../js/modules/callCareSenseURL":23,"./creator_globals":2,"./interface/group_interface":5,"./interface/handlers/curr_pathways":6,"./interface/handlers/horizontal_header":7,"./interface/handlers/role_handler":9,"./interface/recording_interface":11,"./timeline/pathwaysLayout":20}],14:[function(require,module,exports){var g=require("./creator_globals");g.pathwayHeader=require("./pathway_header.js");var timelineInit=require("./timeline/timeline_init.js");var callCareSenseURL=require("../../js/modules/callCareSenseURL");var pathwayObj={};function init(initParams){if(window.innerWidth<450){globalObj.verticalO=true}else{globalObj.verticalO=false}pathwayObj.patientPathway=initParams.patientPathway;initPathwayMetaData(initParams)}function initPathwayMetaData(initParams){if(initParams.patientPathway){pathwayObj.assignedPathwayID=initParams.assignedPathwayID;pathwayObj.patientID=initParams.patientID;pathwayObj.roleID=initParams.roleID;g.allowTimelineMods=true;g.patientPathway=true;callCareSenseURL("pathways/app/pathway/returnAssignedPathwayData",{AssignedPathwayID:initParams.assignedPathwayID},function(returnedPathwayData){returnedPathwayData=JSON.parse(returnedPathwayData);pathwayObj.currentPathwayID=parseInt(returnedPathwayData["PathwayID"]);pathwayObj.anchorDate=returnedPathwayData["AnchorDate"];getPathwayGroups(pathwayObj.currentPathwayID,1,initAllPathwayObj)})}else{g.patientPathway=false;if(initParams.hasOwnProperty("anchorDate")&&initParams.anchorDate!=""&&typeof initParams.anchorDate!="undefined"){pathwayObj.anchorDate=new Date(initParams.anchorDate)}else{pathwayObj.anchorDate=new Date}pathwayObj.currentPathwayID=initParams.currentPathwayID;getPathwayGroups(pathwayObj.currentPathwayID,0,initAllPathwayObj);if(g.verticalO){g.allowTimelineMods=false}else{g.allowTimelineMods=true}}}function initAllPathwayObj(){initializeActivePathwaysGroups();initializeActivePathwaysRoles();g.pathwayHeader.initializeHeader();timelineInit(pathwayObj)}function getPathwayGroups(pathwayID,showDefault,callBack){callCareSenseURL("pathways/app/group/returnAllPathwayGroups",{PathwayID:pathwayID,ShowDefault:showDefault},function(data){data=JSON.parse(data);pathwayObj.groups=data;initializeActivePathwaysGroups();getPathwayRoles(pathwayID,callBack)})}function getPathwayRoles(pathwayID,callBack){callCareSenseURL("pathways/app/role/returnAllPathwayRoles",{PathwayID:pathwayID},function(data){data=JSON.parse(data);pathwayObj.roles=data.roles;pathwayObj.allRoles=data.allRoles;initializeActivePathwaysRoles();callBack()})}function initializeActivePathwaysGroups(){globalObj.groupsToColors=[];groupInfo=pathwayObj.groups;if(!pathwayObj.patientPathway){$.each(groupInfo.default_active,function(key,value){if(value==1){g.activePathways.push(parseInt(groupInfo.group_ids[key]))}});$.each(groupInfo.group_ids,function(key,value){globalObj.groupsToColors[value]=key});_.each(g.staffLineReference,function(d,index){if(g.staffLineInfo[d].hidden==0){g.activePathways.push(index*-1)}});g.activePathways=_.uniq(g.activePathways)}}function initializeActivePathwaysRoles(){globalObj.rolesToColors=[];roleInfo=pathwayObj.roles;if(!pathwayObj.patientPathway){$.each(roleInfo.role_ids,function(key,value){globalObj.rolesToColors[value]=key});$.each(roleInfo.role_names,function(key,value){if(value=="Patient"){globalObj.patientRoleID=parseInt(roleInfo.role_ids[key])}})}}passedPathwayObj={init:init,pathwayObj:pathwayObj,getPathwayGroups:getPathwayGroups,getPathwayRoles:getPathwayRoles};module.exports=passedPathwayObj},{"../../js/modules/callCareSenseURL":23,"./creator_globals":2,"./pathway_header.js":13,"./timeline/timeline_init.js":22}],15:[function(require,module,exports){var g=require("../creator_globals");init=function(){var width,shiftAxis,setScaleDynamically,scale,refreshEvents,eventIndicators;my.select=function(selection){selection.each(function(d,i){})};my.initialize=function(){g_timeline=d3.select(".g_timeline");g_content=d3.select(".g_content");g_timeline.append("g").attr("class","bigActionRect").append("rect").attr("class","backRect").attr("width",function(d){return width-3}).attr("height",function(d){return 45}).attr("x",function(d){return 1}).attr("y",function(d){return 1}).style("display","none").style("opacity",0);g_timeline.select(".bigActionRect").append("g").attr("class","actionVertLines").style("opacity",0);g_timeline.select(".bigActionRect").append("g").attr("class","actionIndicators");if(g.verticalO){}if(!g.verticalO){g_timeline.select(".bigActionRect").append("g").style("opacity",0)}if(!g.verticalO){var pressListener=new Hammer.Manager($(".backRect")[0]);pressListener.add(new Hammer.Press({event:"press",pointer:1,threshold:5,time:750}));pressListener.add(new Hammer.Tap({event:"doubletap",taps:2}));pressListener.on("press doubletap",function(event){if(!g.showingActions){g.showingActions=true;shiftAxis(230,3,false);g_timeline.select(".backRect").transition().duration(750).attr("height",220).style("opacity",1);g_timeline.select(".bigActionRect").selectAll(".eventIndicator").select("rect").transition().duration(750).style("opacity",1);g_timeline.select(".bigActionRect").selectAll(".eventIndicator").select("text").transition().duration(750).style("opacity",1);g_timeline.select(".bigActionRect").select(".actionVertLines").transition().duration(750).style("opacity",1);g_timeline.select(".bigActionRect").select(".closeActions").transition().duration(750).style("opacity",1);g_timeline.select(".bigActionRect").append("text").attr("transform","translate(10,10)").text("Close").attr("class","closeActions").style("opacity",1).on("click",function(){shiftAxis(50,5,false);g_timeline.select(".backRect").transition().duration(0).attr("height",45).style("opacity",0);g_timeline.select(".bigActionRect").selectAll(".eventIndicator").select("rect").transition().duration(750).style("opacity",0);g_timeline.select(".bigActionRect").selectAll(".eventIndicator").select("text").transition().duration(750).style("opacity",0);g_timeline.select(".bigActionRect").select(".actionVertLines").transition().duration(0).style("opacity",0);g_timeline.select(".bigActionRect").select(".closeActions").transition().duration(0).style("opacity",0);if($(".cancel").length){$(".cancel")[0].click()}$(this).remove();g.showingActions=false})}else{xPos=event.center.x-40;yPos=event.center.y-10;createDate=moment(scale.invert(xPos)).utc()._d;createType=0;eventIndicators.createNewEvent(createType,createDate,refreshEvents)}})}};my.revealEvents=function(idToReveal,revealType){if(revealType=="group"){showReveal="groups"}else if(revealType=="role"){showReveal="roles"}else{showReveal="id"}indicators=d3.select(".indicators");var eventIndicatorsReveal=indicators.selectAll(".eventIndicator").data(g.pathway.myData.filter(function(d){return!_.contains(d[showReveal],idToReveal)}),function(d){return d.id});filteredData=g.pathway.myData.filter(function(d){return _.contains(d[showReveal],idToReveal)}),function(d){return d.id};var minDate=d3.min(filteredData,function(d){return d.start_date});var maxDate=d3.max(filteredData,function(d){return d.start_date});if(minDate==maxDate){minDate=moment(minDate).add(-7,"days");maxDate=moment(maxDate).add(7,"days")}setScaleDynamically([minDate,maxDate]).each("end",function(){eventIndicatorsReveal.transition().ease("linear").duration(100).style("opacity",.15);eventIndicatorsReveal.each(function(d){d.background=true;d3.select(".vertLines").select("#line"+d.id).style("opacity",.15)})})};my.deleteRevealEvents=function(idToReveal){indicators=d3.select(".indicators");var eventIndicatorsDel=indicators.selectAll(".eventIndicator").data(g.pathway.myData.filter(function(d){return!_.contains(d.groups,idToReveal)}),function(d){return d.id});eventIndicatorsDel.transition().ease("linear").duration(100).style("opacity",1);eventIndicatorsDel.each(function(d){d.background=false;d3.select(".vertLines").select("#line"+d.id).style("opacity",1)});setTimeout(function(){g.timelineObj.callRefreshEvents()},200)};my.width=function(value){if(!arguments.length)return value;width=value;return my};my.shiftAxis=function(value){if(!arguments.length)return value;shiftAxis=value;return my};my.setScaleDynamically=function(value){if(!arguments.length)return value;setScaleDynamically=value;return my};my.offset=function(value){if(!arguments.length)return value;offset=value;return my};my.shift=function(value){if(!arguments.length)return value;shift=value;return my};my.scale=function(value){if(!arguments.length)return value;scale=value;return my};my.myParent=function(value){if(!arguments.length)return value;myParent=value;return my};my.eventIndicators=function(value){if(!arguments.length)return value;eventIndicators=value;return my};my.refreshEvents=function(value){if(!arguments.length)return value;refreshEvents=value;return my};return my};var my={init:init};module.exports=my},{"../creator_globals":2}],16:[function(require,module,exports){var hs=require("./handleSettings");var callCareSenseURL=require("../../../js/modules/callCareSenseURL");var g=require("../creator_globals");var vertical_rect_width=84;init=function(){var t,zoom,x,offset,shift,scale,yShift,myParent,startPos,renderEvents,setScaleDynamically;vertical_rect_width=$(".staff").attr("width")*.95/3;my.select=function(selection){selection.each(function(d,i){var element=d3.select(this);if(_.has(d,"extended_details")){if(d.extended_details!=null){modDate=d.extended_details.end_date;termEnd=scale(modDate)}else{modDate=d.start_date;termEnd=0}g.verticalO?(c1="x1",c2="y1",c3="x2",c4="y2"):(c1="y1",c2="x1",c3="y2",c4="x2");element.insert("line").attr(c1,function(d){return 0}).attr(c2,function(d){return 0}).attr(c3,function(d){return 0}).attr(c4,function(d){return termEnd}).attr("id","indicatorlineLong").attr("class",d.type).attr("stroke-width","4px");element.insert("line").attr(c1,function(d){return-5}).attr(c2,function(d){return termEnd}).attr(c3,function(d){return 5}).attr(c4,function(d){return termEnd}).attr("id","indicatorTip").attr("class",d.type).attr("stroke-width","4px").style("fill","white");if(!g.verticalO){element.insert("circle").attr("cx",function(d){return 0}).attr("cy",0).attr("r",5).attr("class",d.type).style("fill","white")}}else{if(!g.verticalO){element.insert("circle").attr("cx",function(d){return}).attr("cy",0).attr("r",5).attr("class",d.type)}}my.createLabel(d,element);if(!_.has(d,"extended_details")){d.largestBBox=this.getBBox();if(!g.verticalO){if(d.type=="action"){selectArea=".actionVertLines";translate=0}else{selectArea=".vertLines";translate=offset*g.staffLineInfo[d.type].shiftNum-shift}d3.select(selectArea).insert("line").attr("x1",function(my_d){return d.x}).attr("y1",function(my_d){return translate}).attr("x2",function(my_d){return d.x}).attr("y2",function(my_d){return d.y+d.bbox.y}).attr("id","line"+d.id).attr("class","line "+d.type)}else{createHiddenIndicator(d,element)}}else{d.largestBBox=d.bbox;d.largestBBox.height=d.largestBBox.height+15;if(g.verticalO){createHiddenIndicator(d,element)}}d.highlighted=false})};function createHiddenIndicator(d,element){labelCircle=element.insert("g").attr("id","hiddenChildren"+d.id).attr("style","display:none").on("click",function(d,i){setScaleDynamically([moment.utc(d.start_date)._d,moment.utc(d.hiddenChildrenClickDate)._d],function(){d.y=300})});labelCircle.insert("circle").attr("cx",function(d){return vertical_rect_width/2}).attr("cy",0).attr("r",8).attr("class",d.type+"Label");labelCircle.append("text").attr("text-anchor","middle").attr("class",d.type+"Text childrenNum").attr("style","font-size:10px").text("14").attr("y",4).attr("x",vertical_rect_width/2)}my.restoreElement=function(d,element){if(!g.verticalO){if(d.type=="action"){d.y=0}else{d.y=offset*g.staffLineInfo[d.type].shiftNum-shift}setTimeout(function(){element.select("circle").attr("opacity",1);$("#line"+d.id).attr("visibility","visible");element.selectAll("line").attr("opacity",1)},g.slideSpeed+10)}else{d.y=scale(d.start_date)}$(".line:not(#line"+d.id+")").attr("visibility","visible");element.transition().duration(g.slideSpeed).attr("transform",function(d){var translate;translate=d.x+", "+d.y;return"translate("+translate+")"});setTimeout(function(){renderEvents()},g.slideSpeed+10)};my.hightlightEvent=function(d,element){if(g.verticalO){d.y=screenHeight-100;if(d.type=="action"){setScaleDynamically(calculateDateOffset(d.start_date,screenHeight-30))}}else{if(d.type=="action"){if(!g.showingActions){return}d.y=-10;setScaleDynamically(calculateDateOffset(d.start_date,200));$(".actionVertLines > .line:not(#line"+d.id+")").attr("visibility","hidden")}else{d.y=0;d3.select(".vertLines").selectAll(".line").attr("visibility","hidden");element.select("circle").attr("opacity",0);element.selectAll(".roles").attr("opacity",0);element.selectAll(".groups").attr("opacity",0)}element.select("text").transition().duration(g.slideSpeed).attr("transform","translate(0,0)");element.select(".backRect").transition().duration(g.slideSpeed).attr("transform","translate(0,0)");element.selectAll("line").attr("opacity",0)}if(d.type!="action"){element.transition().duration(g.slideSpeed).attr("transform",function(d){var translate;translate=d.x+", "+d.y;return"translate("+translate+")"})}setTimeout(function(){var popoverHTML;if(d.type=="email"){hs.handleEmailSettings(d,my,element)}else if(d.type=="alert"){hs.handleAlertSettings(d,my,element)}else if(d.type=="survey"){hs.handleSurveySettings(d,my,element)}else if(d.type=="medication"){hs.handleMedicationSettings(d,my,element)}else if(d.type=="rehab"){hs.handleRehabSettings(d,my,element)}else if(d.type=="form"){hs.handleFormSettings(d,my,element)}else if(d.type=="task"){hs.handleTaskSettings(d,my,element)}else if(d.type=="action"){if(g.verticalO){hs.handleActionSettingsVertical(d,my,element)}else{hs.handleActionSettingsHorizontal(d,my,element)}}},g.slideSpeed+10);element.attr("class","eventIndicator highlighted");if(d.type!="action"){$(".eventIndicator:not(.highlighted)").hide()}else{$(".actionIndicators > .eventIndicator:not(.highlighted)").hide()}d.highlighted=true;element.selectAll("circle").style("visibility","visible")};function calculateDateOffset(currDate,shift){date1=moment(currDate);date2=moment(scale.invert(shift));shiftAmount=date1.diff(date2,"hours");returnDates=[moment(scale.domain()[0]).add(shiftAmount,"hours")._d,moment(scale.domain()[1]).add(shiftAmount,"hours")._d];return returnDates}my.render=function(value){if(!arguments.length)return value;render=value;return my};my.scale=function(value){if(!arguments.length)return value;scale=value;return my};my.zoom=function(value){if(!arguments.length)return value;zoom=value;return my};my.offset=function(value){if(!arguments.length)return value;offset=value;return my};my.shift=function(value){if(!arguments.length)return value;shift=value;return my};my.myParent=function(value){if(!arguments.length)return value;myParent=value;return my};my.renderEvents=function(value){if(!arguments.length)return value;renderEvents=value;return my};my.setScaleDynamically=function(value){if(!arguments.length)return value;setScaleDynamically=value;return my};my.createLabel=function(d,element){element.select(".myLabelText").remove();element.select("rect").remove();element.select(".roles").remove();element.select(".groups").remove();if(g.verticalO){yShift=14;xShift=0}else{if(!_.has(d,"extended_details")){yShift=30}else{
yShift=17}}if(d.type=="action"&&!g.showingActions){textOpacity=0}else{textOpacity=1}myText=element.append("text").attr("text-anchor","middle").attr("id","label").text(d.label).attr("class",d.type+"Text myLabelText").style("opacity",textOpacity).style("cursor","grab").attr("y",yShift).attr("dy",0).call(wrap,[this]).call(getBB);if(g.verticalO){rect_w=vertical_rect_width;rect_h=d.bbox.height+6;rect_x=d.bbox.x+d.bbox.width/2-vertical_rect_width/2;rect_y=0;opacity=1}else{rect_w=d.bbox.width+20;rect_h=d.bbox.height*1.7;rect_x=d.bbox.x-10;rect_y=d.bbox.y-d.bbox.height/3;if(!_.has(d,"extended_details")){opacity=1}else{opacity=0}}if(d.type=="action"){opacity=0}var backrect=element.insert("rect",".myLabelText").attr("width",function(d){return rect_w}).attr("height",function(d){return rect_h}).attr("x",function(d){return rect_x}).attr("y",function(d){return rect_y}).attr("rx",4).attr("ry",4).attr("opacity",opacity).style("cursor","grab");if(!g.verticalO&&!g.patientPathway){var roles=element.insert("g").attr("class","roles").insert("g").attr("transform","translate("+(rect_x-3)+","+(rect_y+3)+")").selectAll("circle").data(d.roles).enter().append("circle").attr("cx",function(d){return 0}).attr("cy",function(d,i){return i*4}).attr("r",2).attr("opacity",1).attr("class",function(d,i){globalObj.showRoleIndicators?classes="roleTag tag"+g.rolesToColors[d]:classes="hiddenElement roleTag tag"+g.rolesToColors[d];return classes}).style("cursor","grab");var groups=element.insert("g").attr("class","groups").insert("g").attr("transform","translate("+(rect_x+rect_w+3)+","+(rect_y+3)+")").selectAll("rect").data(_.filter(d.groups,function(num){return num>0})).enter().append("circle").attr("cx",function(d){return 0}).attr("cy",function(d,i){return i*4}).attr("r",2).attr("opacity",1).attr("class",function(d,i){globalObj.showGroupIndicators?classes="groupTag tag"+g.groupsToColors[d]:classes="hiddenElement groupTag tag"+g.groupsToColors[d];return classes}).style("cursor","grab")}if(g.verticalO){backrect.attr("class",d.type+"Rect backRect")}else{backrect.attr("class",d.type+"Rect backRect")}};function getBB(selection){selection.each(function(d){d.bbox=this.getBBox();if(_.has(d,"extended_details")&&d.extended_details!=null){modDate=d.extended_details.end_date;termEnd=scale(modDate);d.maxX=termEnd;if(termEnd<d.x+d.bbox.x+d.bbox.width){d.maxX=d.x+d.bbox.x+d.bbox.width}}else{d.maxX=d.x+d.bbox.x+d.bbox.width}d.minX=d.x+d.bbox.x;d.length=d.maxX-d.minX})}function wrap(text){text.each(function(){var text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=1.1,y=yShift,dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>offset*.9&&g.verticalO){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word)}}})}my.createNewEvent=function(createType,createDate,callback){var url;var passObj={};var eventType=createType;var defaultGroupID=returnDefaultGroup(eventType);startDay=moment(createDate).startOf("day").diff(moment().startOf("day"),"days");if(g.pathway.patientPathway){url="pathways/app/timeline/createNewPatientEvent";passObj={type:eventType,start_date:moment(createDate).set("hour",12).set("minute",0).set("second",0).format(),patientID:g.pathway.patientID,assignedPathwayID:g.pathway.assignedPathwayID}}else{url="pathways/app/timeline/createNewPathwayEvent";passObj={type:eventType,group_id:defaultGroupID,start_date:moment(createDate).set("hour",12).set("minute",0).set("second",0).format(),pathwayID:g.pathway.currentPathwayID}}callCareSenseURL(url,passObj,function(data){endDate=new Date(moment(createDate));endDateConv=moment(endDate.setDate(endDate.getDate()+7)).utc()._d;if(eventType=="alert"){obj={id:data,groups:[defaultGroupID],roles:[],start_date:createDate,StartDay:startDay,label:"New Alert",type:"alert",active:"true",userCreated:"true",details:{message:"Enter a message",voice_link:"link",override_prefs:""}}}else if(eventType=="email"){obj={id:data,groups:[defaultGroupID],roles:[],start_date:createDate,StartDay:startDay,label:"New Information",type:"email",active:"true",userCreated:"true",details:{Category:"",Subject:"",Content:""}}}else if(eventType=="survey"){obj={id:data,groups:[defaultGroupID],roles:[],start_date:createDate,StartDay:startDay,extended_details:null,label:"New survey",type:"survey",active:"true",userCreated:"true",details:{survey_id:""}}}else if(eventType=="action"){obj={id:data,groups:[],roles:[],start_date:createDate,StartDay:startDay,label:"New action",type:"action",active:"true",userCreated:"true",details:{subject:"Subject",body:"Body"}}}else if(eventType=="medication"){obj={id:data,groups:[defaultGroupID],roles:[],start_date:createDate,StartDay:startDay,EndDay:startDay+7,extended_details:{end_date:endDateConv,EndDay:startDay+7,period_amount:"7",period_unit:"days"},label:"New medication",type:"medication",active:"true",userCreated:"true",medication:{medication:"",dose:"",takenumber:"",taketype:"",freqcom:"",freqnum:"",freqtime:"",totaldoses:"",dosesleft:"",times:""}}}else if(eventType=="rehab"){obj={id:data,groups:[defaultGroupID],roles:[],start_date:createDate,StartDay:startDay,EndDay:startDay+7,extended_details:{end_date:endDateConv,EndDay:startDay+7,period_amount:"7",period_unit:"days"},label:"New rehab",type:"rehab",active:"true",userCreated:"true",details:{Category:"",Description:"",Video:""}}}else if(eventType=="form"){obj={id:data,groups:[defaultGroupID],roles:[],start_date:createDate,StartDay:startDay,EndDay:startDay+7,extended_details:{end_date:endDateConv,EndDay:startDay+7,period_amount:"7",period_unit:"days"},label:"New form",type:"form",active:"true",userCreated:"true",details:{pageNum:"",imageID:""}}}else if(eventType=="task"){obj={id:data,groups:[defaultGroupID],roles:[],start_date:createDate,StartDay:startDay,EndDay:startDay+7,extended_details:{end_date:endDateConv,EndDay:startDay+7,period_amount:"7",period_unit:"days"},label:"New task",type:"task",active:"true",userCreated:"true",details:{message:""}}}if(globalObj.hasOwnProperty("patientRoleID")&&(eventType=="alert"||eventType=="email"||eventType=="survey"||eventType=="medication"||eventType=="rehab")){obj.roles.push(globalObj.patientRoleID)}if(globalObj.patientPathway&&eventType=="task"){obj.roles.push(parseInt(globalObj.pathwayObj.pathwayObj.roleID))}hs.passDataElement(obj);g.pathway.myData.push(obj);callback()});function returnDefaultGroup(eventType){switch(eventType){case"alert":return-1;break;case"email":return-2;break;case"survey":return-3;break;case"medication":return-4;break;case"rehab":return-5;break;case"form":return-6;break;case"task":return-7;break}}};return my};var my={init:init};module.exports=my},{"../../../js/modules/callCareSenseURL":23,"../creator_globals":2,"./handleSettings":19}],17:[function(require,module,exports){var hs=require("./handleSettings");var g=require("../creator_globals");init=function(){var t,zoom,x,offset,shift,scale,myParent,startPos,renderEvents,staffLinesOffset,stafflinesShift,hightlightEvent,offset;my.select=function(selection){function initiateDrag(that,d){that.parentNode.appendChild(that);that.classList.add("dragged");d3.select(that).append("svg:rect").attr("width",84).attr("height",12).attr("fill","#ebecf0").attr("x","-42").attr("y","-20").attr("class","dateLabelBack");d3.select(that).append("text").attr("text-anchor","middle").attr("class","dateLabel").attr("y","-10").text("");d3.select(".indicators").selectAll(".eventIndicator").select("circle").style("visibility","visible");if(!g.verticalO){$(".eventIndicator:not(.dragged, .disappear)").fadeTo("opacity",".2");$(".line:not(#line"+d.id+")").fadeTo("opacity",".2")}offset=g.verticalO?d3.event.y-scale(d.start_date):d3.event.x-scale(d.start_date)}function endDrag(that,d){if(!g.verticalO){$(".eventIndicator:not(.dragged, .disappear)").fadeTo("opacity","1");$(".line:not(#line"+d.id+")").fadeTo("opacity","1")}d3.select(".dateLabel").remove();d3.select(".dateLabelBack").remove();that.classList.remove("dragged");setTimeout(function(){g.timelineObj.callRefreshEvents();setTimeout(function(){g.timelineObj.callRefreshEvents()},300)},200)}selection.each(function(d,i){var element=d3.select(this);var dragStarted=false;var dragged=false;var allowDrag=g.allowTimelineMods;element.call(d3.behavior.drag().on("dragstart",dragEventStarted).on("drag",draggedEvent).on("dragend",dragEventEnded));element.on("click",function(){if(globalObj.showGroupIndicators){if(d3.event.shiftKey){handleGroupClick(this)}}if(globalObj.showRoleIndicators){if(d3.event.shiftKey){handleRoleClick(this)}}});function dragEventStarted(d){if(!d.nodrag&&!d.disappear&&allowDrag){dragStarted=true;dragged=false}}function draggedEvent(d){if(dragStarted){dragStarted=false;dragged=true;initiateDrag(this,d)}if(!d.nodrag&&!d.disappear&&allowDrag){if(g.verticalO){d.start_date=moment(scale.invert(d3.event.y-offset)).utc()._d}else{d.start_date=moment(scale.invert(d3.event.x-offset)).utc()._d}d.StartDay=moment(d.start_date).diff(moment(),"days");renderDuringDrag();d3.select(".dateLabel").text(moment(d.start_date).format("MMMM Do, YYYY"))}}function dragEventEnded(d){if(dragged&&!d.nodrag&&!d.disappear&&allowDrag){hs.passDataElement(d);endDrag(this,d)}}element.select("#indicatorTip").call(d3.behavior.drag().on("dragstart",dragTipStarted).on("drag",draggedTipEvent).on("dragend",dragTipEnded));function dragTipStarted(d){d3.event.sourceEvent.stopPropagation();initiateDrag(this.parentNode,d)}function draggedTipEvent(d){if(g.verticalO){d.extended_details.end_date=scale.invert(d.y+d3.event.y)}else{d.extended_details.end_date=scale.invert(d.x+d3.event.x)}if(d.extended_details.end_date<d.start_date){d.extended_details.end_date=d.start_date}d.extended_details.EndDay=moment(d.extended_details.end_date).diff(moment(),"days");d.EndDay=d.extended_details.EndDay;d3.select(".dateLabel").text(moment(d.extended_details.end_date).format("MMMM Do, YYYY"));renderDuringDrag()}function dragTipEnded(d){hs.passDataElement(d);endDrag(this.parentNode,d)}element.select("#indicatorlineLong").call(d3.behavior.drag().on("dragstart",dragLongStarted).on("drag",draggedLongEvent).on("dragend",dragLongEnded));function dragLongStarted(d){d3.event.sourceEvent.stopPropagation();initiateDrag(this.parentNode,d);startPos=undefined}function draggedLongEvent(d){if(typeof startPos=="undefined"){g.verticalO?startPos=d3.event.y:startPos=d3.event.x}length=scale(d.extended_details.end_date)-scale(d.start_date);if(g.verticalO){d.start_date=scale.invert(d.y+(d3.event.y-startPos));d.extended_details.end_date=scale.invert(d.y+(d3.event.y-startPos)+length)}else{d.start_date=scale.invert(d.x+(d3.event.x-startPos));d.extended_details.end_date=scale.invert(d.x+(d3.event.x-startPos)+length)}d.StartDay=moment(d.start_date).diff(moment(),"days");d.extended_details.EndDay=moment(d.extended_details.end_date).diff(moment(),"days");d3.select(".dateLabel").text(moment(d.start_date).format("MMMM Do, YYYY"));renderDuringDrag()}function dragLongEnded(d){hs.passDataElement(d);endDrag(this.parentNode,d)}d.highlighted=false;if(_.has(d,"userCreated")){setTimeout(function(){element.each(function(d,i){delete d["userCreated"];watchForHighlight(this,d);hightlightEvent(d,element)})},900)}function watchForHighlight(that,d){var pressListener=new Hammer.Manager(that);pressListener.add(new Hammer.Press({event:"press",pointer:1,threshold:5,time:750}));pressListener.add(new Hammer.Tap({event:"doubletap",taps:2}));pressListener.on("press doubletap",function(event){if(!d.highlighted){hightlightEvent(d,element)}})}element.each(function(d,i){watchForHighlight(this,d)})})};handleGroupClick=function(selection){groups=_.filter(d3.select(selection).data()[0].groups,function(num){return num>0});var currGroup=parseInt($("#currGroup").val());if(!_.contains(groups,currGroup)){groups.push(currGroup)}else{groups=_.reject(groups,function(num){return num==currGroup})}d3.select(selection).data()[0].groups=groups;tags=d3.select(selection).select(".groups").select("g").selectAll("circle").data(groups);tags.enter().append("circle").attr("cx",function(d){return 0}).attr("cy",function(d,i){return i*4}).attr("r",2).attr("opacity",1).attr("class",function(d,i){return"groupTag tag"+g.groupsToColors[d]}).style("cursor","grab");tags.attr("class",function(d,i){return"groupTag tag"+g.groupsToColors[d]});tags.exit().remove();g.timelineObj.callRefreshEvents();hs.passDataElement(d3.select(selection).data()[0])};handleRoleClick=function(selection){roles=d3.select(selection).data()[0].roles;var currRole=parseInt($("#currRole").val());if(!_.contains(roles,currRole)){roles.push(currRole)}else{roles=_.reject(roles,function(num){return num==currRole})}d3.select(selection).data()[0].roles=roles;tags=d3.select(selection).select(".roles").select("g").selectAll("circle").data(roles);tags.enter().append("circle").attr("cx",function(d){return 0}).attr("cy",function(d,i){return i*4}).attr("r",2).attr("opacity",1).attr("class",function(d,i){return"roleTag tag"+g.rolesToColors[d]}).style("cursor","grab");tags.attr("class",function(d,i){return"roleTag tag"+g.rolesToColors[d]});tags.exit().remove();g.timelineObj.callRefreshEvents();hs.passDataElement(d3.select(selection).data()[0])};renderDuringDrag=function(){indicators=d3.select(".indicators");actionIndicators=d3.select(".bigActionRect").select(".actionIndicators");g.verticalO?(c1="x1",c2="y1",c3="x2",c4="y2"):(c1="y1",c2="x1",c3="y2",c4="x2");function handleEvents(selection){selection.each(function(d){if(g.verticalO){d.y=scale(d.start_date)}else{d.x=scale(d.start_date);if(d.type=="action"){d.y=0;d3.select(".actionVertLines").selectAll("#line"+d.id).attr(c2,function(my_d){return d.x}).attr(c4,function(my_d){return d.x})}else{d3.select(".vertLines").selectAll("#line"+d.id).attr(c2,function(my_d){return d.x}).attr(c4,function(my_d){return d.x})}}}).attr("transform",function(d){return"translate("+d.x+", "+d.y+")"}).each(function(d){if(_.has(d,"extended_details")){g.verticalO?shiftFactor=d.y:shiftFactor=d.x;if(d.extended_details!=null&&!$.isEmptyObject(d.extended_details)){modDate=d.extended_details.end_date;termEnd=scale(modDate)-shiftFactor;d3.select(this).select("#indicatorlineLong").attr(c4,function(d){return termEnd});d3.select(this).select("#indicatorTip").attr(c2,function(d){return termEnd}).attr(c4,function(d){return termEnd})}else{termEnd=0}}})}indicators.selectAll(".eventIndicator").call(handleEvents);actionIndicators.selectAll(".eventIndicator").call(handleEvents);d3.select(".revealLines").selectAll(".revealLine").attr(c3,function(d){return d.x}).attr(c4,function(d){return d.y})};my.scale=function(value){if(!arguments.length)return value;scale=value;return my};my.renderEvents=function(value){if(!arguments.length)return value;renderEvents=value;return my};my.offset=function(value){if(!arguments.length)return value;offset=value;return my};my.shift=function(value){if(!arguments.length)return value;shift=value;return my};my.staffLinesOffset=function(value){if(!arguments.length)return value;staffLinesOffset=value;return my};my.staffLinesShift=function(value){if(!arguments.length)return value;stafflinesShift=value;return my};my.hightlightEvent=function(value){if(!arguments.length)return value;hightlightEvent=value;return my};return my};var my={init:init};module.exports=my},{"../creator_globals":2,"./handleSettings":19}],18:[function(require,module,exports){var g=require("../creator_globals");init=function(){var scale,offset,shift,cutOffLevel;my.select=function(selection){var lowestArray={},xOffsetObj={},compNum,transform,allLevelArrays={},rightMost=0;getBB(selection);var allEventArray={};var allEventIndArray={};selection.each(function(d,i){g.verticalO?fitEventsVertical(d,i,this):fitEventsHorizontal(d,i,this)});function fitEventsHorizontal(d,i,that){if(!_.has(allLevelArrays,d.type)){allLevelArrays[d.type]=[]}levelArray=allLevelArrays[d.type];function fitsTest(i){if(i==levelArray.length){levelArray.push([]);pushObj={label:d.label,minX:d.minX,maxX:d.maxX};levelArray[i].push(pushObj);return true}else{var myReturn=true;_.each(levelArray[i],function(minMax){if((minMax.minX>d.maxX||minMax.maxX<d.minX)==false){myReturn=false}});if(myReturn){pushObj={label:d.label,minX:d.minX,maxX:d.maxX};levelArray[i].push(pushObj)}return myReturn}}i=0;doesFit=false;var myYOffset;if(d.type=="action"){offsetAmount=0}else{offsetAmount=offset*g.staffLineInfo[d.type].shiftNum-shift}while(!doesFit&&i<cutOffLevel){doesFit=fitsTest(i);if(!_.has(d,"extended_details")){myYOffset=i*30+offsetAmount-d.y}else{myYOffset=i*30+offsetAmount-d.y}i=i+1;if(i==cutOffLevel&&rightMost==0){}}if(doesFit||i<cutOffLevel){myDate=d.start_date;d.x=scale(myDate);d3.select(that).selectAll("rect").style("visibility","visible");d3.select(that).selectAll("text").style("visibility","visible");d3.select(that).selectAll("line").style("visibility","visible");d3.select(that).selectAll(".groupTag").style("visibility","visible");d3.select(that).selectAll("circle").style("visibility","visible")}else{d3.select(that).selectAll("text").style("visibility","hidden");d3.select(that).selectAll("rect").style("visibility","hidden");d3.select(that).selectAll(".groupTag").style("visibility","hidden");d3.select(that).selectAll("line").style("visibility","hidden");if(_.has(d,"extended_details")){d3.select(that).selectAll("circle").style("visibility","hidden")}}transform=d.x+", "+d.y;d3.select(that).attr("transform","translate("+transform+")");d3.select(that).select("#label").transition().duration(100).ease("linear").attr("transform","translate(0,"+myYOffset+")");d3.select(that).select(".backRect").transition().duration(100).ease("linear").attr("transform","translate(0,"+myYOffset+")");d3.select(that).select(".roles").transition().duration(100).ease("linear").attr("transform","translate(0,"+myYOffset+")");d3.select(that).select(".groups").transition().duration(100).ease("linear").attr("transform","translate(0,"+myYOffset+")");if(!g.verticalO){d3.select(".vertLines").selectAll("#line"+d.id).attr("y1",function(my_d){return d.y}).attr("y2",function(my_d){return 30+d.y+myYOffset-15})}if(_.has(d,"extended_details")){g.verticalO?(c1="x1",c2="y1",c3="x2",c4="y2"):(c1="y1",c2="x1",c3="y2",c4="x2");if(d.extended_details!=null){modDate=d.extended_details.end_date;termEnd=scale(modDate)-d.x}else{modDate=d.start_date;termEnd=scale(modDate)-d.x}d3.select(that).select("#indicatorlineLong").attr(c4,function(d){return termEnd}).attr("transform","translate(0,"+myYOffset+")");d3.select(that).select("circle").attr("transform","translate(0,"+myYOffset+")");d3.select(that).select("#indicatorTip").attr(c2,function(d){return termEnd}).attr(c4,function(d){return termEnd}).attr("transform","translate(0,"+myYOffset+")")}}function fitEventsVertical(d,i,that){var xOffset=offset*g.staffLineInfo[d.type].shiftNum-shift;traslateVal=d.y;var status=false;d.hiddenChildrenCount=0;d.hiddenChildrenClickDate=null;d3.select(that).select("#hiddenChildren"+d.id).attr("style","display:none");if(d.type=="action"){xOffset=0}if(_.has(d,"extended_details")&&d.extended_details!=null){d.x=xOffset}if(!_.has(d,"extended_details")){d3.select(that).attr("transform","translate("+xOffset+", "+traslateVal+")")}else{d3.select(that).attr("transform","translate("+xOffset+", "+traslateVal+")");overlapAmount=calculateOverlap(i,d.y,d.y+d.lineBox.height,d.type);d3.select(that).select("#indicatorTip").attr("transform","translate("+overlapAmount+", 0)").style("opacity",1-overlapAmount/40*1);d3.select(that).select("#indicatorlineLong").attr("transform","translate("+overlapAmount+", 0)").style("opacity",1-overlapAmount/40*1)}if(_.has(d,"extended_details")&&d.extended_details!=null){modDate=d.extended_details.end_date;termEnd=scale(modDate)-traslateVal;d3.select(that).select("#indicatorlineLong").attr("y2",function(d){return termEnd});d3.select(that).select("#indicatorTip").attr("y1",function(d){return termEnd}).attr("y2",function(d){return termEnd})}if(!_.has(allEventArray,d.type)){myArray=[];myIndArray=[];allEventArray[d.type]=myArray;allEventIndArray[d.type]=myIndArray;eventArray=allEventArray[d.type];eventIndArray=allEventIndArray[d.type]}else{eventArray=allEventArray[d.type];eventIndArray=allEventIndArray[d.type]}if(eventArray.length==0){d.disappear=false;d3.select(that).attr("style","display:inline");eventArray.push(d);eventIndArray.push(that)}else{i=eventArray.length-1;d_l=eventArray[i];parent=true;hiddenChildrenCount=0;while(d_l.disappear==true&&i>0){hiddenChildrenCount=hiddenChildrenCount+1;i=i-1;d_l=eventArray[i];parent=false}ind_l=eventIndArray[i];topEvent=d3.select(ind_l);currEvent=d3.select(that);status=overlapStatus(d_l,d);if(status=="disappear"){hiddenChildrenCount=hiddenChildrenCount+1;currEvent.attr("style","display:none");currEvent.select("#hiddenChildren"+d.id).attr("style","display:none");d.disappear=true;d_l.hiddenChildrenClickDate=d.start_date;if(moment(d_l.start_date).format("YYYY-MM-DD")==moment(d.start_date).format("YYYY-MM-DD")){d.start_date=moment(d_l.start_date).add("2","hours")._d}}else{if(parent){topEvent.select("#label").transition().duration(0).ease("linear").attr("transform","translate(0,0)");topEvent.select("rect").transition().duration(0).ease("linear").attr("transform","translate(0,0)")}currEvent.transition().duration(50).attr("style","display:inline");d.disappear=false}d_l.hiddenChildrenCount=hiddenChildrenCount;if(d_l.hiddenChildrenCount>0&&!d_l.disappear){topEvent.select(".childrenNum").text(d_l.hiddenChildrenCount);topEvent.select("#hiddenChildren"+d_l.id).attr("style","display:inline")}else{topEvent.select("#hiddenChildren"+d_l.id).attr("style","display:none")}eventArray.push(d);eventIndArray.push(that)}}function overlapStatus(top,bottom){if(top.y+top.largestBBox.height>bottom.y){return"disappear"}else{return"none"}}function calculateOverlap(i,top,bottom,type){var offsetFactor=10;var myObj={};myObj.top=top;myObj.bottom=bottom;if(!xOffsetObj.hasOwnProperty(type)){xOffsetObj[type]=[]}xOffsetArray=xOffsetObj[type];j=0;while(j<=i){if(j==xOffsetArray.length){var levelArray=[];levelArray.push(myObj);xOffsetArray.push(levelArray);return verifyJ(j)*offsetFactor}else{fits=true;_.each(xOffsetArray[j],function(compObj){if(!(myObj.top>compObj.bottom||myObj.bottom<compObj.top)){fits=false}});if(fits){xOffsetArray[j].push(myObj);return verifyJ(j)*offsetFactor}}j=j+1}xOffsetObj[type]=xOffsetArray;return verifyJ(j)*offsetFactor;function verifyJ(j){if(j>7){j=7}if(j>1){if(j%2==0){j=j/2*-1}else{j=parseInt(j/2)+1}}return j}}};my.scale=function(value){if(!arguments.length)return value;scale=value;return my};my.offset=function(value){if(!arguments.length)return value;offset=value;return my};my.shift=function(value){if(!arguments.length)return value;shift=value;return my};my.cutOffLevel=function(value){if(!arguments.length)return value;cutOffLevel=value;return my};my.eventIndicator=function(value){if(!arguments.length)return value;eventIndicator=value;return my};return my;function getBB(selection){selection.each(function(d){if(!_.has(d,"extended_details")||!g.verticalO){d.bbox=this.getBBox()}else{d.bbox=d3.select(this).select("rect")[0][0].getBBox();d.lineBox=this.getBBox()}if(_.has(d,"extended_details")&&d.extended_details!=null&&!$.isEmptyObject(d.extended_details)&&!g.verticalO){modDate=d.extended_details.end_date;termEnd=scale(modDate);d.maxX=termEnd;if(termEnd<d.x+d.bbox.x+d.bbox.width){d.maxX=d.x+d.bbox.x+d.bbox.width}}else{d.maxX=d.x+d.bbox.x+d.bbox.width}d.minX=d.x+d.bbox.x;d.length=d.maxX-d.minX})}};var my={init:init};module.exports=my},{"../creator_globals":2}],19:[function(require,module,exports){var gCurr_d;var callCareSenseURL=require("../../../js/modules/callCareSenseURL");var g=require("../creator_globals");if(!tinymce)tinymce={};if(!myApp)myApp={};if(!$$)$$=function(){};if(!moment)moment=function(){};function formToObject(form){var results=myApp.formToJSON(form);var json={};var push_counters={};function build(base,key,value){base[key]=value;return base}function push_counter(key){if(push_counters[key]===undefined){push_counters[key]=0}return push_counters[key]++}for(var key in results){var value=results[key];if(!/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/.test(key)){return results}var k,keys=key.match(/[a-zA-Z0-9_]+|(?=\[\])/g),merge=value,reverse_key=key;while((k=keys.pop())!==undefined){reverse_key=reverse_key.replace(new RegExp("\\["+k+"\\]$"),"");if(k.match(/^$/)){merge=build([],push_counter(reverse_key),merge)}else if(k.match(/^\d+$/)){merge=build([],k,merge)}else if(k.match(/^[a-zA-Z0-9_]+$/)){merge=build({},k,merge)}}json=$.extend(true,json,merge)}return json}function returnSetActions(eventID,callBack){callCareSenseURL("pathways/app/timeline/returnSetActions",{EventID:eventID},callBack)}function deleteSetActions(pathwayActionsID,callBack){callCareSenseURL("pathways/app/timeline/deleteSetAction",{PathwayActionsID:pathwayActionsID,isPatientPathway:g.patientPathway},callBack)}function deleteDataElement(d){if(!g.allowTimelineMods){myApp.alert("Editing is not allowed in this mode. Your changes will not be saved.");return}var passObj={};passObj.id=d.id;passObj.type=d.type;passObj.isPatientPathway=g.patientPathway;callCareSenseURL("pathways/app/timeline/deleteDataElement",passObj)}function passDataElement(d,callBack){if(!g.allowTimelineMods){myApp.alert("Editing is not allowed in this mode. Your changes will not be saved.");return}var passObj={};passObj.label=d.label;passObj.type=d.type;passObj.id=d.id;passObj.start_date=moment(d.start_date).startOf("day").format();passObj.details=d.details;if(d.type=="alert"){passObj.message=d.details.message}else if(d.type=="task"){passObj.message=d.details.message}else if(d.type=="form"){passObj.pageNum=d.details.pageNum;passObj.imageID=d.details.imageID}else if(d.type=="survey"){passObj.expiration_amount=d.expiration_amount;passObj.expiration_unit=d.expiration_unit;passObj.weekdays_only=d.weekdays_only;passObj.max_lag_days=d.max_lag_days;passObj.survey_id=d.details.survey_id;passObj.email_survey=d.details.email_survey}else if(d.type=="action"){passObj.conditionLabel=d.details.conditionLabel;passObj.condition=d.details.condition;passObj.actions=d.details.actions}else if(d.type=="medication"){passObj.medication=d.medication}if(_.has(d,"extended_details")&&(!$.isEmptyObject(d.extended_details)&&d.extended_details!=null)){passObj.end_date=moment(d.extended_details.end_date).startOf("day").format();passObj.period_amount=d.extended_details.period_amount;passObj.period_unit=d.extended_details.period_unit}passObj.isPatientPathway=g.pathway.patientPathway;passObj.groups=d.groups;passObj.roles=d.roles;callCareSenseURL("pathways/app/timeline/processDataElement",passObj,callBack)}function handleEmailSettings(d,parent,element){$.post("/_pathways/creator/php/email_settings.php",{myObject:d,patientPathway:g.pathway.patientPathway},function(data){popoverHTML=data;g.verticalO?findObj="circle":findObj="text";myApp.popover(popoverHTML,$(".highlighted").find(findObj),true);if(g.verticalO){modPopUp()}$$(".myLink").click(function(){deleteElement(d)});$$(".form-to-json").click(function(){if($("#toggleTinyMCE").text()!=="TinyMCE"){toggleTinyMCE()}var storedData=formToObject("#my-form");d.label=storedData.label;if(g.pathway.patientPathway){d.start_date=moment(storedData.start_date).startOf("day").set("hour",12).set("minute",0).set("second",0)._d}else{d.StartDay=storedData.start_day;d.start_date=moment().add(storedData.start_day,"day").startOf("day").set("hour",12).set("minute",0).set("second",0)._d}d.details=storedData.details;parent.createLabel(d,element);myApp.closeModal(".popover");$(".remove-on-close").remove()});$$(".popover").on("close",function(){closePopup(d,parent,element)});generateVideoList();$("#toggleTinyMCE").click(toggleTinyMCE);function toggleTinyMCE(){if($("#toggleTinyMCE").text()==="TinyMCE"){tinymce.init({selector:"#email_body",plugins:["searchreplace fullscreen table paste"]});$("#toggleTinyMCE").text("HTML")}else{tinymce.remove("#email_body");$("#toggleTinyMCE").text("TinyMCE")}}})}function handleRehabSettings(d,parent,element){$.post("/_pathways/creator/php/rehab_settings.php",{myObject:d,patientPathway:g.pathway.patientPathway},function(data){popoverHTML=data;g.verticalO?findObj="circle":findObj="text";myApp.popover(popoverHTML,$(".highlighted").find(findObj),true);if(g.verticalO){modPopUp()}$$(".myLink").click(function(){deleteElement(d)});$$(".form-to-json").click(function(){if($("#toggleTinyMCE").text()!=="TinyMCE"){toggleTinyMCE()}var storedData=formToObject("#my-form");d.label=storedData.label;updateExtendedEvents(d,storedData);d.details=storedData.details;parent.createLabel(d,element);myApp.closeModal(".popover");$(".remove-on-close").remove()});$$(".popover").on("close",function(){closePopup(d,parent,element)});$("#toggleTinyMCE").click(toggleTinyMCE);function toggleTinyMCE(){if($("#toggleTinyMCE").text()==="TinyMCE"){tinymce.init({selector:"#email_body",plugins:["searchreplace fullscreen table paste"]});$("#toggleTinyMCE").text("HTML")}else{tinymce.remove("#email_body");$("#toggleTinyMCE").text("TinyMCE")}}})}function handleFormSettings(d,parent,element){$.post("/_pathways/creator/php/form_settings.php",{myObject:d,patientPathway:g.pathway.patientPathway},function(data){popoverHTML=data;g.verticalO?findObj="circle":findObj="text";myApp.popover(popoverHTML,$(".highlighted").find(findObj),true);if(g.verticalO){modPopUp()}$$(".myLink").click(function(){deleteElement(d)});$$(".form-to-json").click(function(){var storedData=myApp.formToJSON("#my-form");d.label=storedData.label;updateExtendedEvents(d,storedData);d.details.pageNum=storedData.pageNum;d.details.imageID=storedData.imageID;parent.createLabel(d,element);myApp.closeModal(".popover");$(".remove-on-close").remove()});$$(".popover").on("close",function(){closePopup(d,parent,element)})})}function handleTaskSettings(d,parent,element){$.post("/_pathways/creator/php/task_settings.php",{myObject:d,patientPathway:g.pathway.patientPathway},function(data){popoverHTML=data;g.verticalO?findObj="circle":findObj="text";myApp.popover(popoverHTML,$(".highlighted").find(findObj),true);if(g.verticalO){modPopUp()}$$(".myLink").click(function(){deleteElement(d)});$$(".form-to-json").click(function(){var storedData=myApp.formToJSON("#my-form");d.label=storedData.label;updateExtendedEvents(d,storedData);d.details.message=storedData.message;parent.createLabel(d,element);myApp.closeModal(".popover");$(".remove-on-close").remove()});$$(".popover").on("close",function(){closePopup(d,parent,element)})})}function insertAtCaret(element,text){var caretPos=element[0].selectionStart,currentValue=element.val();element.val(currentValue.substring(0,caretPos)+text+currentValue.substring(caretPos))}function generateVideoList(){var video_list_item_template=_.template('<li>        <a href="#" class="item-link item-content close-popup">            <div class="item-media">                <img class="play-video" src="<%- videoLink %>/<%- DirName %>/still.jpeg" width="80">            </div>            <div class="item-inner">                <div class="item-title-row">                    <div class="item-title"><%- Title %></div>                </div>                <div class="item-subtitle"><%- GroupedUserID %></div>                <div class="item-text"><%- Description %></div>            </div>        </a>    </li>');callCareSenseURL("pathways/app/video/getAllVideosWithUserIDType","",function(d){for(var ii=0;ii<d["videos"].length;ii++){var videoObj=d["videos"][ii];videoObj["videoLink"]=d["videoLink"];videoObj["UserID"]=videoObj["UserID"]==null?"Video not user specific":videoObj["UserID"];$("ul#video-list").append(video_list_item_template(videoObj));$("ul#video-list li").last().on("click",function(e){if(videoObj["Group"]==null){var email_placeholder="{{"+videoObj["UserType"]+".video."+videoObj["DirName"]+"."+$("input[name='email-link-type']:checked").val()+"}}";
}else{var email_placeholder="{% if '"+videoObj["Group"]+"' in video_group %}{{video_group."+videoObj["Group"]+"."+$("input[name='email-link-type']:checked").val()+"}}{% endif %}";videoObj["Description"]="This is an example video. Each physician will have their own."}e.preventDefault();insertAtCaret($("#email_body"),email_placeholder)});$("ul#video-list img.play-video").click(function(){window.open("https://www.caresense.com/public/vPlayer/playVideo/"+videoObj["DirName"])})}})}function modPopUp(){var popUpStartLeft=$(".popover").css("left").replace(/[^-\d\.]/g,"");var popUpAngleLeft=$(".popover-angle").css("left").replace(/[^-\d\.]/g,"");var newAngleLeft=parseInt(popUpStartLeft)+parseInt(popUpAngleLeft)-10;$(".popover").css("left","10px");if(window.innerWidth<360){$(".popover").css("width",window.innerWidth-20+"px")}else{$(".popover").css("width","360px")}$(".popover-angle").css("left",newAngleLeft+"px")}function dateFromString(str){var a=$.map(str.split(/[^0-9]/),function(s){return parseInt(s,10)});return new Date(a[0],a[1]-1||0,a[2]||1,a[3]||0,a[4]||0,a[5]||0,a[6]||0)}function handleAlertSettings(d,parent,element){$.post("/_pathways/creator/php/alert_settings.php",{myObject:d,patientPathway:g.pathway.patientPathway},function(data){popoverHTML=data;g.verticalO?findObj="circle":findObj="text";myApp.popover(popoverHTML,$(".highlighted").find(findObj),true);if(g.verticalO){modPopUp()}$$(".myLink").click(function(){deleteElement(d)});$$(".form-to-json").click(function(){var storedData=myApp.formToJSON("#my-form2");d.label=storedData.label;if(storedData.weekdays_only.length>0){d.weekdays_only="1";d.max_lag_days=storedData.max_lag_days}else{d.weekdays_only=null;d.max_lag_days=null}if(g.pathway.patientPathway){d.start_date=moment(storedData.start_date).startOf("day").set("hour",12).set("minute",0).set("second",0)._d}else{d.StartDay=storedData.start_day;d.start_date=moment().add(storedData.start_day,"day").startOf("day").set("hour",12).set("minute",0).set("second",0)._d}d.details.message=storedData.message;parent.createLabel(d,element);myApp.closeModal(".popover");$(".remove-on-close").remove()});$$(".popover").on("close",function(){closePopup(d,parent,element)})})}function handleMedicationSettings(d,parent,element,fromMain,callBack){if(!d.hasOwnProperty("medication")){d.medication={}}if(!fromMain){d.isPopover=1}else{d.isPopover=0;g.pathway={};g.pathway.patientPathway=true}$.post("/_pathways/creator/php/medication_settings.php",{myObject:d,patientPathway:g.pathway.patientPathway},function(data){popoverHTML=data;if(!fromMain){g.verticalO?findObj="circle":findObj="text";myApp.popover(popoverHTML,$(".highlighted").find(findObj),true);if(g.verticalO){modPopUp()}}else{$(".popup-contactinfo").select(".content-block").html(data);myApp.popup(".popup-contactinfo")}$("#freqcom").on("change",function(){if($(this).val()=="QHS"){$("#QHS_Settings").css("display","inline")}else{$("#QHS_Settings").css("display","none")}if($(this).val()=="QD"){$("#MedTime1").css("display","inline");$("#MedTime2").css("display","none");$("#MedTime3").css("display","none");$("#MedTime4").css("display","none")}else if($(this).val()=="BID"){$("#MedTime1").css("display","inline");$("#MedTime2").css("display","inline");$("#MedTime3").css("display","none");$("#MedTime4").css("display","none")}else if($(this).val()=="TID"){$("#MedTime1").css("display","inline");$("#MedTime2").css("display","inline");$("#MedTime3").css("display","inline");$("#MedTime4").css("display","none")}else if($(this).val()=="QID"){$("#MedTime1").css("display","inline");$("#MedTime2").css("display","inline");$("#MedTime3").css("display","inline");$("#MedTime4").css("display","inline")}else if($(this).val()=="QHS"){$("#MedTime1").css("display","inline");$("#MedTime2").css("display","none");$("#MedTime3").css("display","none");$("#MedTime4").css("display","none")}if($(this).val()=="QHS"){$("#timesLabel").html("Start Time: ")}else if($(this).val()=="QD"){$("#timesLabel").html("Time: ")}else{$("#timesLabel").html("Times: ")}});$("#freqcom").change();$$(".delete").click(function(){deleteElement(d)});$$(".save").click(function(){function returnTimes(){var time="";if($("#MedTime1").is(":visible")){time=time+$("#MedTime1").val()+","}if($("#MedTime2").is(":visible")){time=time+$("#MedTime2").val()+","}if($("#MedTime3").is(":visible")){time=time+$("#MedTime3").val()+","}if($("#MedTime4").is(":visible")){time=time+$("#MedTime4").val()+","}time=time.slice(0,-1);return time}var storedData=myApp.formToJSON("#medication-form");d.label=storedData.label;if(g.pathway.patientPathway){d.start_date=moment(storedData.start_date).startOf("day").set("hour",12).set("minute",0).set("second",0)._d;d.end_date=moment(storedData.end_date).startOf("day").set("hour",12).set("minute",0).set("second",0)._d;if(!d.hasOwnProperty("extended_details")){d.extended_details={}}d.extended_details.end_date=d.end_date}else{d.StartDay=storedData.start_day;d.start_date=moment().add(storedData.start_day,"day").startOf("day").set("hour",12).set("minute",0).set("second",0)._d;d.extended_details.EndDay=storedData.end_day;d.EndDay=storedData.end_day;d.end_date=moment().add(storedData.end_day,"day").startOf("day").set("hour",12).set("minute",0).set("second",0)._d;d.extended_details.end_date=d.end_date}d.medication.medication=storedData.medication;d.medication.dose=storedData.dose;d.medication.takenumber=storedData.takenumber;d.medication.taketype=storedData.taketype;d.medication.freqcom=storedData.freqcom;d.medication.freqnum=storedData.freqnum;d.medication.freqtime=storedData.freqtime;d.medication.totaldoses=storedData.totaldoses;d.medication.times=returnTimes();if(fromMain){callCareSenseURL("pathways/app/pathway/setMedReviewed",{EventID:d.id},function(){g.allowTimelineMods=true;g.patientPathway="true";passDataElement(d);myApp.closeModal(".popup-contactinfo");callBack()})}else{parent.createLabel(d,element);myApp.closeModal(".popover");$(".remove-on-close").remove()}});$$(".popover").on("close",function(){closePopup(d,parent,element)})})}function handleSurveySettings(d,parent,element){$.post("/_pathways/creator/php/survey_settings.php",{myObject:d,patientPathway:g.pathway.patientPathway},function(data){var findObj;popoverHTML=data;g.verticalO?findObj="circle":findObj="text";myApp.popover(popoverHTML,$(".highlighted").find(findObj),true);if(g.verticalO){modPopUp()}$$(".myLink").click(function(){deleteElement(d)});$$(".form-to-json").click(function(){var storedData=myApp.formToJSON("#my-form3");d.label=storedData.label;updateExtendedEvents(d,storedData);d.expiration_amount=storedData.expiration_amount;d.expiration_unit=storedData.expiration_unit;if(storedData.weekdays_only.length>0){d.weekdays_only="1";d.max_lag_days=storedData.max_lag_days}else{d.weekdays_only=null;d.max_lag_days=null}d.details.survey_id=storedData.survey_id;if(storedData.email_survey.length>0){d.details.email_survey="1"}else{d.details.email_survey="0"}parent.createLabel(d,element);myApp.closeModal(".popover");$(".remove-on-close").remove()});$$(".popover").on("close",function(){closePopup(d,parent,element)})})}function handleActionSettingsVertical(d,parent,element){function closeActionSettings(){d.highlighted=false;myApp.closeModal(".popover");$(".remove-on-close").remove();parent.restoreElement(d,element);element.attr("class","eventIndicator");$(".actionIndicators > .eventIndicator:not(.highlighted)").show()}$.post("/_pathways/creator/php/action_settings_vertical.php",{myObject:d},function(data){popoverHTML=data;g.verticalO?findObj="circle":findObj="text";myApp.popover(popoverHTML,$(".highlighted").find(findObj),true);if(g.verticalO){modPopUp()}$("#selectConditionLabel").html(d.details.conditionLabel);$$(".myLink").click(function(){deleteDataElement(d);closeActionSettings()});$$(".cancel").click(function(){closeActionSettings()});$$("#AddAction").click(function(){showActionOptions(d,$("#SelectActionType").val())});_.each(d.details.actions,function(action){$$("#DeleteAction"+action.id).click(function(){$(this).closest("tr").remove();d.details.actions=_.without(d.details.actions,_.findWhere(d.details.actions,{id:action.id}));deleteSetActions(action.id)})});$$(".form-to-json").click(function(){var storedData=myApp.formToJSON("#my-action-form");d.label=storedData.label;d.start_date=dateFromString(storedData.start_date+" 12:00");closeActionSettings();passDataElement(d)})})}function handleActionSettingsHorizontal(d,parent,element){function closeActionSettings(){d.highlighted=false;element.attr("class","eventIndicator");$("#actionSettings").html("");$("#actionSettings").hide();$(".eventIndicator").show();parent.restoreElement(d,element)}$.post("/_pathways/creator/php/action_settings.php",{myObject:d},function(data){popoverHTML=data;g.verticalO?findObj="circle":findObj="text";$("#actionSettings").html(popoverHTML);$("#actionSettings").show();if(d.details.hasOwnProperty("conditionLabel")){$("#selectConditionLabel").html(d.details.conditionLabel)}$$(".myLink").click(function(){deleteActionElement(d);closeActionSettings()});$$(".cancel").click(function(){closeActionSettings()});$$("#selectCondition").click(function(){showConditions(d)});$$("#AddAction").click(function(){showActionOptions(d,$("#SelectActionType").val())});_.each(d.details.actions,function(action){$$("#EditAction"+action.id).click(function(){showActionOptions(d,action.actionType,action.actionTarget,action.id)});$$("#DeleteAction"+action.id).click(function(){gCurr_d=d;deleteSetActions(action.id,refreshSetEvents)})});$$(".form-to-json").click(function(){var storedData=myApp.formToJSON("#my-action-form");d.label=storedData.label;d.start_date=dateFromString(storedData.start_date+" 12:00");$("#event"+d.id).find("#label").text(d.label);$("#actionSettings").html("");$("#actionSettings").hide();d.highlighted=false;element.attr("class","eventIndicator");$(".eventIndicator").show();parent.restoreElement(d,element);passDataElement(d)})})}function updateExtendedEvents(d,storedData){if(g.pathway.patientPathway){d.start_date=moment(storedData.start_date).startOf("day").set("hour",12).set("minute",0).set("second",0)._d}else{d.StartDay=storedData.start_day;d.start_date=moment().add(storedData.start_day,"day").startOf("day").set("hour",12).set("minute",0).set("second",0)._d}if($("#hasExtendedDetails").is(":checked")){d.extended_details={};if(g.pathway.patientPathway){d.extended_details.end_date=dateFromString(storedData.end_date+" 12:00")}else{d.extended_details.EndDay=storedData.end_day;d.extended_details.end_date=moment().add(storedData.end_day,"day").startOf("day").set("hour",12).set("minute",0).set("second",0)._d}d.extended_details.period_amount=storedData.period_amount;d.extended_details.period_unit=storedData.period_unit}else{d.extended_details={}}}function showConditions(d){$.post("/_pathways/creator/php/action_conditions.php",{},function(data){popoverHTML=data;myApp.popover(popoverHTML,$("#selectCondition"),true);$("#selectConditionButtons").find(".cancel").click(function(){myApp.closeModal(".popover");$(".remove-on-close").remove()});$$("#selectConditionButtons").find(".select").click(function(){d.details.conditionLabel=$("#conditionLabel option:selected").text();d.details.condition=$("#condition").val().trim();$("#selectConditionLabel").html($("#conditionLabel option:selected").text());passDataElement(d);myApp.closeModal(".popover");$(".remove-on-close").remove()})})}function showActionOptions(d,type,val,id){if(type=="Show Group"||type=="Hide Group"){if(type=="Show Group"){groupActionType="Show"}else{groupActionType="Hide"}$.post("/_pathways/creator/php/action_showhide_group.php",{ActionType:groupActionType},function(data){popoverHTML=data;myApp.popover(popoverHTML,$("#AddAction"),true);$("#showhideGroup").append($("#currGroup").clone());if(val){$("#showhideGroup").find("#currGroup").val(val)}$("#showhideGroupButtons").find(".cancel").click(function(){myApp.closeModal(".popover");$(".remove-on-close").remove()});$$("#showhideGroupButtons").find(".select-hide-group").click(function(){addNewAction(d,groupActionType+" Group",$("#showhideGroup").find("#currGroup").val(),groupActionType+" group: "+$("#showhideGroup").find("#currGroup option:selected").text().trim(),id);gCurr_d=d;passDataElement(d,function(){refreshSetEvents()});myApp.closeModal(".popover");$(".remove-on-close").remove()})})}}function refreshSetEvents(){function refresh(returned_d){returned_d=JSON.parse(returned_d);gCurr_d.details.actions=returned_d;d=gCurr_d;$.post("/_pathways/creator/php/set_actions.php",{myObject:d.details.actions},function(data){$("#setActions").html(data);_.each(d.details.actions,function(action){$$("#EditAction"+action.id).click(function(){showActionOptions(d,action.actionType,action.actionTarget,action.id)});$$("#DeleteAction"+action.id).click(function(){gCurr_d=d;deleteSetActions(action.id,refreshSetEvents)})})})}returnSetActions(gCurr_d.id,refresh)}function addNewAction(d,actionType,actionTarget,display,id){if(!d.details.hasOwnProperty("actions")){d.details.actions=[]}if(!id){d.details.actions.push({actionType:actionType,actionTarget:actionTarget,display:display})}else{_.findWhere(d.details.actions,{id:id}).actionType=actionType;_.findWhere(d.details.actions,{id:id}).actionTarget=actionTarget;_.findWhere(d.details.actions,{id:id}).display=display}}function deleteElement(d){function removeLines(selection){selection.each(function(d){$("#line"+d.id).remove()})}g.pathway.myData=_.reject(g.pathway.myData,function(object){return object.id==d.id});var allFormIndicators=d3.select(".indicators").selectAll(".eventIndicator").data(g.pathway.myData.filter(function(d){return true}),function(d){return d.id});allFormIndicators.exit().call(removeLines).remove();myApp.closeModal(".popover");deleteDataElement(d)}function deleteActionElement(d){function removeLines(selection){selection.each(function(d){$("#line"+d.id).remove()})}g.pathway.myData=_.reject(g.pathway.myData,function(object){return object.id==d.id});actionIndicators=d3.select(".bigActionRect").select(".actionIndicators");var allActionIndicators=actionIndicators.selectAll(".eventIndicator").data(g.pathway.myData.filter(function(d){return d.type=="action"}),function(d){return d.id});allActionIndicators.exit().call(removeLines).remove();deleteDataElement(d)}function closePopup(d,parent,element){d.highlighted=false;element.attr("class","eventIndicator");$(".eventIndicator").show();parent.restoreElement(d,element);passDataElement(d)}publicFunctions={handleEmailSettings:handleEmailSettings,handleRehabSettings:handleRehabSettings,handleFormSettings:handleFormSettings,handleAlertSettings:handleAlertSettings,handleTaskSettings:handleTaskSettings,handleMedicationSettings:handleMedicationSettings,handleSurveySettings:handleSurveySettings,handleActionSettingsVertical:handleActionSettingsVertical,handleActionSettingsHorizontal:handleActionSettingsHorizontal,passDataElement:passDataElement};module.exports=publicFunctions},{"../../../js/modules/callCareSenseURL":23,"../creator_globals":2}],20:[function(require,module,exports){var timeline=require("./timeline");var g=require("../creator_globals");function init(){var screenWidth=window.innerWidth;var screenHeight=window.innerHeight;if(g.verticalO){var chromeHeight=$(".navbar").height()+$("#pathway_header").height();var margin_timeline={top:25,right:50,bottom:10,left:55},margin_brush={top:25,right:0,bottom:10,left:screenWidth-margin_timeline.right},width_timeline=screenWidth-margin_timeline.right-margin_timeline.left,width_brush=screenWidth-margin_brush.right-margin_brush.left,height_timeline=screenHeight-margin_timeline.top-chromeHeight;height_brush=screenHeight-margin_timeline.top-chromeHeight;var scaleVal=height_timeline;var orient="left";var brush_axis_translation=width_brush+", 0";var timeline_axis_translation="0, 0";var g_labels}else{var margin_timeline={top:10,right:0,bottom:110,left:0},margin_brush={top:610,right:0,bottom:40,left:0},width_timeline=$("#timelineArea").width()-margin_timeline.left-margin_timeline.right,width_brush=$("#timelineArea").width()-margin_timeline.left-margin_timeline.right,height_timeline=680-margin_timeline.top-margin_timeline.bottom,height_brush=680-margin_brush.top-margin_brush.bottom;var scaleVal=width_timeline;var orient="bottom";var brush_axis_translation="0, "+height_brush;var timeline_axis_translation="0, "+height_timeline;var g_labels}var scale_timeline=d3.time.scale.utc().range([0,scaleVal]);scale_brush=d3.time.scale.utc().range([0,scaleVal]);var axis_timeline=d3.svg.axis().scale(scale_timeline).orient(orient).innerTickSize(-width_timeline).outerTickSize(0).tickPadding(12),axis_brush=d3.svg.axis().scale(scale_brush).orient(orient).tickFormat(function myFormat(d){a=moment([moment(g.pathway.anchorDate).year(),moment(g.pathway.anchorDate).month(),moment(g.pathway.anchorDate).date()]);b=moment([moment(d).year(),moment(d).month(),moment(d).date()]);return b.diff(a,"days")+" days"});var svg=d3.select("#timelineArea").append("svg").attr("class","container").attr("width","100%").attr("height",height_timeline+margin_timeline.top+margin_timeline.bottom);var clip=svg.append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",width_timeline).attr("height",height_timeline);var clip2=svg.append("svg:clipPath").attr("id","clip2").append("svg:rect").attr("width",screenWidth).attr("height",height_timeline).attr("transform","translate(-55,0)");var clip3=svg.append("svg:clipPath").attr("id","clip3").append("svg:rect").attr("width",width_timeline).attr("height",height_timeline).attr("transform","translate(55,0)");if(g.verticalO){g_labels=svg.append("g").attr("clip-path",function(d,i){return"url(#clip3)"}).append("g").attr("class","g_labels").attr("transform","translate("+margin_timeline.left+","+(margin_timeline.top-15)+")");g_nextEvent=svg.append("g").append("a").attr("id","showOtherEvents").append("text").attr("text-anchor","right").attr("id","otherEventsSVGLink").text("More >").attr("class","medicationText ").attr("y",17).attr("x",screenWidth-45).attr("opacity",1)}$("#showOtherEvents").on("click",function(){g.timelineObj.callShowOtherEvents()});g_timeline=svg.append("g").attr("class","g_timeline").attr("transform","translate("+margin_timeline.left+","+margin_timeline.top+")");if(!g.verticalO){g_labels=g_timeline}var g_brush=svg.append("g").attr("class","g_brush").attr("transform","translate("+margin_brush.left+","+margin_brush.top+")");if(g.verticalO){g_timeline.attr("clip-path",function(d,i){return"url(#clip2)"});g_brush.attr("clip-path",function(d,i){return"url(#clip2)"})}var brush=d3.svg.brush().on("brush",brushed);g.verticalO?brush.y(scale_brush):brush.x(scale_brush);function brushed(){scale_timeline.domain(brush.empty()?scale_brush.domain():brush.extent());g_timeline.select(".axis").call(axis_timeline);g.timelineObj.scale(scale_timeline);g.timelineObj.zoomMe()}my.my=function(selection){selection.each(function(data){if(typeof data=="undefined"||data.hasOwnProperty("events")&&_.isEmpty(data.events)){smallDate=new Date(moment());smallDateConv=smallDate.setDate(smallDate.getDate()-10);bigDate=new Date(moment());bigDateConv=bigDate.setDate(bigDate.getDate()+10)}else{smallDate=new Date(g.pathway.anchorDate);smallDateConv=smallDate.setDate(smallDate.getDate()+(parseInt(g.pathway.spanStartDay)-7));bigDate=new Date(g.pathway.anchorDate);bigDateConv=bigDate.setDate(bigDate.getDate()+(parseInt(g.pathway.spanEndDay)+7))}scale_timeline.domain([smallDateConv,bigDateConv]);scale_brush.domain([moment(g.pathway.anchorDate).add(g.pathway.spanStartDay,"days"),moment(g.pathway.anchorDate).add(g.pathway.spanEndDay,"days")]);g_brush.append("g").attr("transform","translate("+brush_axis_translation+")").call(axis_brush).attr("class","axis regular");g_timeline.append("g").call(axis_timeline).attr("transform","translate("+timeline_axis_translation+")").attr("class","axis");var brushExtent=scale_timeline.domain();if(brushExtent[0]<scale_brush.domain()[0]){brushExtent[0]=scale_brush.domain()[0]}if(brushExtent[1]>scale_brush.domain()[1]){brushExtent[1]=scale_brush.domain()[1]}brush.extent(brushExtent);d3.select(".g_brush").select(".brush").transition().duration(g.slideSpeed).call(brush);timeline.init();g.timelineObj=timeline.width(width_timeline).height(height_timeline).scale(scale_timeline).brush_scale(scale_brush).axis(axis_timeline).brush(brush);d3.select(".g_timeline").datum(data).call(g.timelineObj.select)});if(g.verticalO){g_brush.append("g").attr("class","brush").call(brush).selectAll("rect").attr("x",0).attr("width",width_brush)}else{g_brush.append("g").attr("class","brush").call(brush).selectAll("rect").attr("y",0).attr("height",width_brush)}myDelay=750};my.resize=function(){screenWidth=window.innerWidth;width=screenWidth;screenHeight=window.innerHeight;g_timeline=d3.select(".g_timeline");if(g.verticalO){chromeHeight=$(".navbar").height()+$("#pathway_header").height();scaleVal=screenHeight-margin_timeline.top-chromeHeight}else{scaleVal=parseInt(d3.select("#timelineArea").style("width"),10)}scale_timeline.range([0,scaleVal]);scale_brush.range([0,scaleVal]);axis_timeline.scale(scale_timeline);axis_brush.scale(scale_brush);g.timelineObj.scale(scale_timeline);g.timelineObj.brush_scale(scale_brush);g_timeline.select(".axis").call(axis_timeline);g_brush.select(".regular").call(axis_brush);if(g.verticalO){d3.select("#timelineArea").attr("height",screenHeight-chromeHeight);d3.select(".container").attr("height",screenHeight-chromeHeight)}else{d3.select("#timelineArea").attr("width",width+margin_timeline.left+margin_timeline.right)}g.timelineObj.resize(scaleVal)}}var my={init:init};module.exports=my},{"../creator_globals":2,"./timeline":21}],21:[function(require,module,exports){var g=require("../creator_globals");var eventIndicator=require("./eventIndicator");var eventOrganizer=require("./eventOrganizer");var eventIndicatorEvents=require("./eventIndicatorEvents");var actionArea=require("./actions");init=function(){var g_timeline,g_content,indicators,actionIndicators,actionAreaObj,revealLines,c1,c2,c3,c4,width,height,staffLinesOffset,stafflinesShift,scale,brush_scale,eventOrganizerObj,staffline_axis,axis,brush,size,numAxes,eventIndicatorEventsObj,eventIndicators,hideType="medication";var pathway=g.pathway;my.select=function(selection){initializeTimeline();selection.each(function(data){pathway.myData=data.events;g.myData=data.events;refreshEvents()})};function handleEvents(selection,init){if(init){selection=selection.append("svg:g").style("opacity",0).attr("class","eventIndicator")}selection.each(function(d){if(g.verticalO){d.y=scale(d.start_date);if(d.type=="action"){d.x=0}else{d.x=staffLinesOffset*g.staffLineInfo[d.type].shiftNum-stafflinesShift}}else{d3.select(this).attr("id","event"+d.id).attr("class","eventIndicator");d.x=scale(d.start_date);if(d.type=="action"){d.y=0;d3.select(".actionVertLines").selectAll("#line"+d.id).attr(c2,function(my_d){return d.x}).attr(c4,function(my_d){return d.x})}else{d.y=staffLinesOffset*g.staffLineInfo[d.type].shiftNum-stafflinesShift;d3.select(".vertLines").selectAll("#line"+d.id).attr(c2,function(my_d){return d.x}).attr(c4,function(my_d){return d.x})}}}).sort(function(a,b){if(g.verticalO){if(a.y-b.y!=0){return a.y-b.y}else{return a.id-b.id}}else{if(parseInt(b.length)==parseInt(a.length)){return b.id-a.id}else{return b.length-a.length}}});if(init){g.verticalO?fadeInTime=0:fadeInTime=750;selection.transition().duration(fadeInTime).style("opacity",1).call(eventIndicators.select).call(eventIndicatorEventsObj.select).each("end",function(){setTimeout(function(){selection.call(eventOrganizerObj.select);g_content.transition().duration(750).style("opacity",1)},100)})}else{selection.call(eventOrganizerObj.select)}}function returnData(myData){returnArray=_.filter(myData,function(myEvent){return shouldShow(myEvent)});return returnArray}function shouldShow(myEvent){showEvent=true;if(!_.has(myEvent,"userCreated")){if(g.staffLineInfo[myEvent.type].hidden==1||myEvent.type=="action"){showEvent=false}if(myEvent.groups&&myEvent.groups.length!=_.intersection(myEvent.groups,g.activePathways).length){showEvent=false}}return showEvent}function refreshEvents(){indicators=d3.select(".indicators");var allEventIndicators=indicators.selectAll(".eventIndicator").data(returnData(pathway.myData),function(d){return d.id});allEventIndicators.enter().call(handleEvents,true);allEventIndicators.exit().call(removeLines).remove();renderEvents()}function removeLines(selection){selection.each(function(d){$("#line"+d.id).remove()})}function renderEvents(){indicators.selectAll(".eventIndicator").call(handleEvents,false);d3.select(".treatment").attr("transform",function(d){myDate=moment(g.pathway.anchorDate).startOf("day").set("hour",12).set("minute",0).set("second",0);g.verticalO?translate="0, "+scale(myDate):translate=scale(myDate)+", "+0;return"translate("+translate+")"});d3.select(".treatmentSmall").attr("transform",function(d){myDate=moment(g.pathway.anchorDate).startOf("day").set("hour",12).set("minute",0).set("second",0);g.verticalO?translate="0, "+brush_scale(myDate):translate=brush_scale(myDate)+", "+0;return"translate("+translate+")"});d3.select(".relStart").attr("transform",function(d){myDate=moment(g.pathway.relIntervalStartDate).startOf("day").set("hour",12).set("minute",0).set("second",0);g.verticalO?translate="0, "+scale(myDate):translate=scale(myDate)+", "+0;return"translate("+translate+")"});d3.select(".relEnd").attr("transform",function(d){myDate=moment(g.pathway.relIntervalEndDate).startOf("day").set("hour",12).set("minute",0).set("second",0);g.verticalO?translate="0, "+scale(myDate):translate=scale(myDate)+", "+0;return"translate("+translate+")"});adjustScales()}function updateStafflineScale(){$.each(g.staffLineInfo,function(key,value){g_timeline.select(".axis").call(axis);g_timeline.select("."+key).call(staffline_axis)})}function initializeTimeline(){var orientation;g_timeline=d3.select(".g_timeline");g_brush=d3.select(".g_brush");var rectangle=g_timeline.append("rect").attr("class","staff").attr("x",0).attr("y",0).attr("width",width).attr("height",height).style("fill","#dadee1").style("opacity",.2).each(function(d,i){listenForPress(this,d)});if(g.verticalO){g_clipContent=g_timeline.append("g").attr("class","g_clipContent").attr("clip-path",function(d,i){return"url(#clip)"}).attr("transform","translate(0, 0)");g_content=g_clipContent.append("g").attr("class","g_content").attr("opacity",0)}else{g_content=g_timeline}if(g.verticalO){numAxes=3}else{numAxes=0;g.eventLevel=[];_.each(g.staffLineInfo,function(value,prop){if(value.hidden===0&&prop!="action"){g.eventLevel.push(prop);numAxes=numAxes+1}})}g.verticalO?orientation="right":orientation="top";g.verticalO?size=width:size=height;g.verticalO?(c1="x1",c2="y1",c3="x2",c4="y2"):(c1="y1",c2="x1",c3="y2",c4="x2");g_timeline.insert("line").attr(c1,function(d){return 0}).attr(c2,function(d){return 0}).attr(c3,function(d){return size}).attr(c4,function(d){return 0}).attr("class","treatment").attr("stroke-width","4px").style("opacity",.3);g_brush.insert("line").attr(c1,function(d){return 0}).attr(c2,function(d){return 0}).attr(c3,function(d){return size}).attr(c4,function(d){return 0}).attr("class","treatmentSmall").attr("stroke-width","4px").style("opacity",1);if(!g.verticalO){if(g.pathway.hasOwnProperty("relIntervalStartDate")){g_timeline.insert("line").attr(c1,function(d){return 0}).attr(c2,function(d){return 0}).attr(c3,function(d){return size}).attr(c4,function(d){return 0}).attr("class","relStart").attr("stroke-width","4px").style("opacity",.2)}if(g.pathway.hasOwnProperty("relIntervalEndDate")){g_timeline.insert("line").attr(c1,function(d){return 0}).attr(c2,function(d){return 0}).attr(c3,function(d){return size}).attr(c4,function(d){return 0}).attr("class","relEnd").attr("stroke-width","4px").style("opacity",.1)}}staffline_axis=d3.svg.axis().scale(scale).ticks(0).tickSize(0,0,1.5).orient(orientation);updateZoom();cutOffLevel=parseInt(((height-50)/numAxes-15)/30);shiftAxis(50,cutOffLevel,true);eventIndicators=eventIndicator.init().render(renderEvents).zoom(zoom).offset(staffLinesOffset).shift(stafflinesShift).scale(scale).renderEvents(my.zoomMe).setScaleDynamically(setScaleDynamically).myParent(g.timelineObj);eventOrganizerObj=eventOrganizer.init().scale(scale).offset(staffLinesOffset).shift(stafflinesShift).cutOffLevel(cutOffLevel);eventIndicatorEventsObj=eventIndicatorEvents.init().scale(scale).renderEvents(renderEvents).staffLinesOffset(staffLinesOffset).staffLinesShift(stafflinesShift).hightlightEvent(eventIndicators.hightlightEvent);actionAreaObj=actionArea.init().width(width).scale(scale).refreshEvents(refreshEvents).eventIndicators(eventIndicators).shiftAxis(shiftAxis).setScaleDynamically(setScaleDynamically);actionAreaObj.initialize();updateZoom();if(!g.verticalO){g_timeline.append("g").style("opacity",0).attr("class","vertLines").transition().duration(750).style("opacity",1)}g_content.append("g").attr("class","indicators");createTimelineAxisLabels()}function createTimelineAxisLabels(){iterator=0;$.each(g.staffLineInfo,function(key,value){g.staffLineInfo[key].shiftNum=iterator;var translation;g.verticalO?translation=iterator*staffLinesOffset-stafflinesShift+", 0":translation="0, "+(iterator*staffLinesOffset-stafflinesShift);getBBox=function(selection){selection.each(function(d){d.bbox=this.getBBox()})};if(g.verticalO){y=7;x=0}else{y=-12;if(key=="medication"){x=20}else if(key=="survey"){x=26}else if(key=="alert"){x=18}else{x=20}}if(key!="action"){if(g.verticalO){if(g.staffLineInfo[key].hidden==0){d3.select(".g_labels").append("text").attr("text-anchor","middle").text(g.staffLineLabels[key]).attr("class",key+"Text "+key+"AxisText").attr("y",y).attr("x",x).attr("opacity",1).attr("transform","translate("+translation+")")}}else{if(g.staffLineInfo[key].hidden==0){g_content.append("text").attr("text-anchor","middle").text(g.staffLineLabels[key]).attr("class",key+"Text "+key+"AxisText").attr("y",y).attr("x",x).attr("opacity",1).attr("transform","translate("+translation+")").call(getBBox)}}if(!g.verticalO){if(g.staffLineInfo[key].hidden==0){g_timeline.insert("rect","."+key+"Text").attr("class",key+"AxisRect").attr("width",function(d){return d.bbox.width}).attr("height",function(d){return d.bbox.height}).attr("x",function(d){return d.bbox.x}).attr("y",function(d){return d.bbox.y}).attr("transform","translate("+translation+")").style("fill","#f8f9f9")}}}if(g.staffLineInfo[key].hidden==0){iterator=iterator+1}})}function updateZoom(){function doZoom(){updateBrushExtent();d3.select(".g_brush").select(".brush").call(brush);updateStafflineScale();renderEvents()}if(g.verticalO){zoom=d3.behavior.zoom().y(scale).on("zoom",function(){doZoom()}).scaleExtent([.01,10])}else{zoom=d3.behavior.zoom().x(scale).on("zoom",function(){doZoom()}).scaleExtent([.01,10])}d3.select(".staff").call(zoom).on("dblclick.zoom",null);d3.select(".backRect").call(zoom).on("dblclick.zoom",null);adjustScales()}function listenForPress(that,d){var pressListener=new Hammer.Manager(that);pressListener.add(new Hammer.Press({event:"press",pointer:1,threshold:5,time:750}));if(g.verticalO){pressListener.add(new Hammer.Swipe({}));pressListener.on("swipeleft",function(ev){shiftEventsLeft()});pressListener.on("swiperight",function(ev){shiftEventsRight()})}pressListener.add(new Hammer.Tap({event:"doubletap",taps:2}));pressListener.on("press doubletap",function(event){if(g.verticalO){xPos=event.center.x-70;yPos=event.center.y-40-topOffset;createTypeNum=Math.round(xPos/width*4);createDate=moment(scale.invert(yPos)).startOf("day").set("hour",12).set("minute",0).set("second",0)._d}else{xPos=event.center.x-$("#timelineArea").offset().left;yPos=event.center.y-60;createDate=moment(scale.invert(xPos)).startOf("day").set("hour",12).set("minute",0).set("second",0)._d;if(g.eventLevel.length==1){createTypeNum=0}else{if(yPos<50){createTypeNum=0}else{yPos=yPos-50;createTypeNum=Math.round(yPos/staffLinesOffset)}}}createTypeNum==g.eventLevel.length?createTypeNum=g.eventLevel.length-1:createTypeNum=createTypeNum;if(g.verticalO&&hideType=="alert"){
createTypeNum=createTypeNum+1}createType=g.eventLevel[createTypeNum];eventIndicators.createNewEvent(createType,createDate,refreshEvents)})}function shiftEventsLeft(){shiftAmount=-1*staffLinesOffset;d3.select(".g_labels").transition().duration(750).attr("transform","translate("+(shiftAmount+55)+", 11)");g_content.transition().duration(750).attr("transform","translate("+shiftAmount+", 0)").each("end",function(){hideType="alert";refreshEvents()})}function shiftEventsRight(){shiftAmount=0;d3.select(".g_labels").transition().duration(750).attr("transform","translate("+(shiftAmount+55)+", 11)");g_content.transition().duration(750).attr("transform","translate("+shiftAmount+", 0)").each("end",function(){hideType="medication";refreshEvents()})}function updateBrushExtent(){var brushScale=scale.domain();if(brushScale[0]<scale_brush.domain()[0]){brushScale[0]=scale_brush.domain()[0]}if(brushScale[1]>scale_brush.domain()[1]){brushScale[1]=scale_brush.domain()[1]}brush.extent(brushScale)}function shiftAxis(shiftSize,cutOffLevel,init){g.verticalO?linesize=width/numAxes:linesize=shiftSize;g.verticalO?staffLinesOffset=linesize:staffLinesOffset=(size-linesize)/numAxes;g.verticalO?stafflinesShift=staffLinesOffset/2:stafflinesShift=(size-linesize)/numAxes-linesize;iterator=1;$.each(g.staffLineInfo,function(key,value){var translation;if(g.verticalO){translation=(iterator-1)*staffLinesOffset-stafflinesShift+", 0"}else{if(key=="action"){translation="0, 0"}else{translation="0, "+((iterator-1)*staffLinesOffset-stafflinesShift)}}if(init){if(value.hidden==0){if(key!="action"||!g.verticalO){g_content.append("g").call(staffline_axis).attr("class",key).attr("opacity",1).attr("transform","translate("+translation+")")}}}else{g_timeline.select("."+key).attr("transform","translate("+translation+")")}if(!g.verticalO){if(key=="alert"){g_timeline.select(".action")}}g_timeline.select("."+key+"AxisText").attr("transform","translate("+translation+")");g_timeline.select("."+key+"AxisRect").attr("transform","translate("+translation+")");if(g.staffLineInfo[key].hidden==0){iterator=iterator+1}});if(!init){eventIndicators.offset(staffLinesOffset).shift(stafflinesShift);eventOrganizerObj.offset(staffLinesOffset).shift(stafflinesShift).cutOffLevel(cutOffLevel);renderEvents()}}function adjustScales(){minExtent=scale.domain()[0];maxExtent=scale.domain()[1];if(maxExtent-minExtent>14688e5*100){axis.ticks(d3.time.months,12).tickFormat(d3.time.format("%Y"))}else if(maxExtent-minExtent>14688e5*50){axis.ticks(d3.time.months,12).tickFormat(d3.time.format("%Y"))}else if(maxExtent-minExtent>14688e5*12){axis.ticks(d3.time.months,1).tickFormat(d3.time.format("%b '%y"))}else if(maxExtent-minExtent>14688e5*1.5){axis.ticks(d3.time.weeks,1).tickFormat(d3.time.format("%d %b"))}else if(maxExtent-minExtent>1228e5){axis.ticks(d3.time.days,1).tickFormat(d3.time.format("%d %b"))}else{axis.ticks(d3.time.hours,10).tickFormat(d3.time.format("%d %b"))}}function setScaleDynamically(dates,atEnd){if(moment(dates[0]).format("YYYY-MM-DD")===moment(dates[1]).format("YYYY-MM-DD")){dates[1]=moment(dates[1]).add("days",1)._d}diff=moment(dates[1]).format("x")-moment(dates[0]).format("x");dates[0]=moment(parseInt(moment(dates[0]).format("x"))-diff/10)._d;dates[1]=moment(parseInt(moment(dates[1]).format("x"))+diff/10)._d;return d3.transition().duration(750).tween("zoom",function(){var ix=d3.interpolate(scale.domain(),dates);return function(t){newScaleVals=ix(t);d1=new Date(newScaleVals[0]);d2=new Date(newScaleVals[1]);scale.domain([d1,d2]);g_timeline.select(".axis").transition().duration(0).call(axis);updateBrushExtent();d3.select(".g_brush").select(".brush").transition().duration(0).call(brush);updateZoom();renderEvents()}}).each("end",atEnd)}my.scale=function(value){if(!arguments.length)return value;scale=value;return my};my.brush_scale=function(value){if(!arguments.length)return value;brush_scale=value;return my};my.width=function(value){if(!arguments.length)return value;width=value;return my};my.height=function(value){if(!arguments.length)return value;height=value;return my};my.axis=function(value){if(!arguments.length)return value;axis=value;return my};my.brush=function(value){if(!arguments.length)return value;brush=value;return my};my.zoom=function(value){if(!arguments.length)return value;zoom=value;return my};my.resize=function(newScale){if(g.verticalO){height=newScale}else{width=newScale}my.zoomMe()};my.zoomMe=function(){adjustScales();updateStafflineScale();renderEvents();updateZoom();updateBrushExtent()};my.addEvents=function(data){_.extend(pathway.myData,_.where(data.events,{PathwayID:pickedPathway}));refreshEvents()};my.removeEvents=function(data){refreshEvents()};my.callRefreshEvents=function(){refreshEvents()};my.hideGroupIndicators=function(){selection=d3.selectAll(".groupTag");$(selection[0]).each(function(d,i){i.classList.add("hiddenElement")})};my.showGroupIndicators=function(){selection=d3.selectAll(".groupTag");$(selection[0]).each(function(d,i){i.classList.remove("hiddenElement")})};my.hideRoleIndicators=function(){selection=d3.selectAll(".roleTag");$(selection[0]).each(function(d,i){i.classList.add("hiddenElement")})};my.showRoleIndicators=function(){selection=d3.selectAll(".roleTag");$(selection[0]).each(function(d,i){i.classList.remove("hiddenElement")})};my.revealEvents=function(groupToReveal,revealType,hightlight){if(hightlight){$(".Highlightlink").html("Highlight");$(".highlightRoleLink").html("Highlight");actionAreaObj.deleteRevealEvents();actionAreaObj.revealEvents(groupToReveal,revealType)}else{actionAreaObj.deleteRevealEvents()}};my.deleteRevealEvents=function(groupToReveal){actionAreaObj.deleteRevealEvents(groupToReveal)};my.callSetScaleDynamically=function(dates){setScaleDynamically(dates)};my.callShiftAxis=function(shiftAmount,rowHeight,init){shiftAxis(shiftAmount,rowHeight,init)};my.callShowOtherEvents=function(){if(hideType=="medication"){shiftEventsLeft();d3.select("#otherEventsSVGLink").text("< Back");$("#otherEventsSVGLink").attr("class","alertText")}else{shiftEventsRight();d3.select("#otherEventsSVGLink").text("More >");$("#otherEventsSVGLink").attr("class","medicationText")}};my.slide=function(scale){g_timeline.select(".axis").transition().duration(g.slideSpeed).call(axis);updateBrushExtent();d3.select(".g_brush").select(".brush").transition().duration(g.slideSpeed).call(brush);updateZoom()}};var my={init:init};module.exports=my},{"../creator_globals":2,"./actions":15,"./eventIndicator":16,"./eventIndicatorEvents":17,"./eventOrganizer":18}],22:[function(require,module,exports){var callCareSenseURL=require("../../../js/modules/callCareSenseURL");var layOut=require("./pathwaysLayout");var g=require("../creator_globals");var patientPathway;function getPatientEvents(assignedPathwayID,callBack){callCareSenseURL("pathways/app/timeline/returnPatientEvents",{AssignedPathwayID:assignedPathwayID},callBack)}function getPathwayEvents(pathwayID,anchorDate,callBack){callCareSenseURL("pathways/app/timeline/returnPathwayEvents",{PathwayID:pathwayID,AnchorDate:moment(anchorDate).utc().format()},callBack)}function getPathwayInfo(pathwayID,callBack){callCareSenseURL("pathways/app/pathway/returnPathwayInfo",{PathwayID:pathwayID},callBack)}function initializeTimeline(pathwayObj){getPathwayInfo(pathwayObj.currentPathwayID,function(data){span=JSON.parse(data);g.pathway.spanStartDay=span.startDay;g.pathway.spanEndDay=span.endDay;g.pathway.hasMeds=span.hasMeds;initalizePaths(span);if(span.relIntervalStart){g.pathway.relIntervalStartDate=moment().add(parseInt(span.relIntervalStart),"days")}else{if(g.pathway.hasOwnProperty("relIntervalStartDate")){delete g.pathway.relIntervalStartDate}}if(span.relIntervalEnd){g.pathway.relIntervalEndDate=moment().add(parseInt(span.relIntervalEnd),"days")}else{if(g.pathway.hasOwnProperty("relIntervalEndDate")){delete g.pathway.relIntervalEndDate}}if(pathwayObj.patientPathway){getPatientEvents(pathwayObj.assignedPathwayID,populateTimeline)}else{getPathwayEvents(pathwayObj.currentPathwayID,g.pathway.anchorDate,populateTimeline)}})}function initalizePaths(data){data.showAlerts=="No"?g.staffLineInfo.alert.hidden=1:g.staffLineInfo.alert.hidden=0;data.showEmails=="No"?g.staffLineInfo.email.hidden=1:g.staffLineInfo.email.hidden=0;data.showSurveys=="No"?g.staffLineInfo.survey.hidden=1:g.staffLineInfo.survey.hidden=0;data.showMeds=="No"?g.staffLineInfo.medication.hidden=1:g.staffLineInfo.medication.hidden=0;data.showRehab=="No"?g.staffLineInfo.rehab.hidden=1:g.staffLineInfo.rehab.hidden=0;data.showForms=="No"?g.staffLineInfo.form.hidden=1:g.staffLineInfo.form.hidden=0;data.showTasks=="No"?g.staffLineInfo.task.hidden=1:g.staffLineInfo.task.hidden=0}function populateTimeline(data){d3.select(window).on("resize",function(){layOut.resize()});data=JSON.parse(data);initializeActiveEvents(data,initNextData);function initNextData(data){initPatientPathway(data);layOut.init();d3.select("#timelineArea").datum(data).call(layOut.my)}}function initializeActiveEvents(data,callBack){if(g.pathway.patientPathway){callCareSenseURL("pathways/app/group/getPatientGroupStatus",{assignedPathwayID:g.pathway.assignedPathwayID},function(groupStatus){groupStatus=JSON.parse(groupStatus);$.each(groupStatus,function(key,value){if(parseInt(value)==1){g.activePathways.push(parseInt(key))}});g.activePathways=_.uniq(g.activePathways);$.each(g.activePathways,function(key,value){$("#GroupCheckbox"+value).prop("checked",true);$("#HighlightLink"+value).show()});callBack(data)})}else{callBack(data)}}function initPatientPathway(myData){$.each(myData.events,function(key,value){value.start_date=moment(value.start_date).utc()._d;if(_.has(value,"extended_details")){if(value.extended_details!=null){value.extended_details.end_date=moment(value.extended_details.end_date)._d}}})}module.exports=initializeTimeline},{"../../../js/modules/callCareSenseURL":23,"../creator_globals":2,"./pathwaysLayout":20}],23:[function(require,module,exports){var g=require("./globals");function callCareSenseURL(url,params,callback,errorCallback){url=g.server+url;APIKey=g.APIKey;if(typeof params!="object"){if(params!=""){params="APIKey="+APIKey.token+"&"+params}else{params="APIKey="+APIKey.token}}else{params["APIKey"]=APIKey.token}$.ajax({type:"POST",url:url,data:params,success:function(myData){if(callback){callback(myData)}},error:function(data,status,error){if(errorCallback){errorCallback(data)}if(data.status==403){loggedin=false;if(!g.isBigScreen){f7.contentView.router.loadPage("html/login_screen.html")}else{window.top.location.href=server+"login/logout"}}if(data.status==0){if(!g.gNoInternetNotificationUp){g.gNoInternetNotificationUp=true;f7.myApp.addNotification({title:"No internet connection",message:"It appears that the internet connection is down. Please check your connection and try again",hold:5e3,onClose:function(){g.gNoInternetNotificationUp=false}})}}}})}module.exports=callCareSenseURL},{"./globals":24}],24:[function(require,module,exports){var globalObj={};initGlobals=function(){globalObj.d=new Date;globalObj.app={};globalObj.loggedin=false;globalObj.username="";globalObj.server=location.origin+"/";globalObj.APIKey="";globalObj.lastVals={};globalObj.pingTimer=null;globalObj.mySettings={};globalObj.gottenAllSettings=false;if(typeof gIsBigScreen!=="undefined"){globalObj.isBigScreen=gIsBigScreen}else{globalObj.isBigScreen=true}};initGlobals();module.exports=globalObj},{}],index:[function(require,module,exports){var initObj=require("./creator");module.exports=initObj},{"./creator":1}]},{},["index"]);
//# sourceMappingURL=app.js.map
